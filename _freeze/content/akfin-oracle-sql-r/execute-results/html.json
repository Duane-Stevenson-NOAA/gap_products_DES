{
  "hash": "96c38d1fb6526ac872a66d8006df809f",
  "result": {
    "markdown": "---\ntitle: Access data\nnumber-sections: true\nnumber-depth: 3\n---\n\n\n\n\n## Access data via Oracle (AFSC only) {.unnumbered}\n\nAFSC `Oracle` users can access the database via `SQL developer` to view and pull the production data directly from the `GAP_PRODUCTS` `Oracle` schema. The user can also use `SQL developer` to view and pull the GAP Products data directly from the `GAP_PRODUCTS` `Oracle` schema. \n\n### Connect to Oracle from R\n\nMany users will want to access the data from `Oracle` using `R`. The user will need to install the `RODBC` `R` package and ask OFIS (IT) connect `R` to `Oracle`. Then, use the following code in `R` to establish a connection from `R` to `Oracle`: \n\nHere, the user can establish the oracle connection by entering their username and password in the `channel <- gapindex::oracle_connect()` function. Never save usernames or passwords in scripts that may be intentionally or unintentionally shared with others. If no username and password is entered in the function, pop-ups will appear on the screen asking for the username and password. \n\nAfter you connect to VPN, you'll be able to log into Oracle. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(RODBC)\nchannel <- gapindex::get_connected()\n```\n:::\n\n\n## Data SQL Query Examples: {.unnumbered}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gapindex)\nlibrary(RODBC)\nlibrary(flextable)\nlibrary(ggplot2)\nlibrary(magrittr)\nlibrary(dplyr)\n```\n:::\n\n\n### Ex. Select all data from tables\n\nYou can download all of the tables locally using a variation of the code below. Once connected, pull and save the tables of interest into the `R` environment. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlocations <- c(\n  \"GAP_PRODUCTS.AKFIN_AGECOMP\", \n  \"GAP_PRODUCTS.AKFIN_AREA\", \n  \"GAP_PRODUCTS.AKFIN_BIOMASS\", \n  \"GAP_PRODUCTS.AKFIN_CATCH\", \n  \"GAP_PRODUCTS.AKFIN_CPUE\", \n  \"GAP_PRODUCTS.AKFIN_CRUISE\", \n  \"GAP_PRODUCTS.AKFIN_HAUL\", \n  \"GAP_PRODUCTS.AKFIN_LENGTH\", \n  \"GAP_PRODUCTS.AKFIN_METADATA_COLUMN\", \n  \"GAP_PRODUCTS.AKFIN_SIZECOMP\", \n  \"GAP_PRODUCTS.AKFIN_SPECIMEN\", \n  \"GAP_PRODUCTS.AKFIN_STRATUM_GROUPS\", \n  \"GAP_PRODUCTS.AKFIN_SURVEY_DESIGN\", \n  \"GAP_PRODUCTS.AKFIN_TAXONOMIC_CLASSIFICATION\"\n)\n\nfor (i in 1:length(locations)) {\n  print(locations[i])\n  a <- RODBC::sqlQuery(channel, paste0(\"SELECT * FROM \", locations[i]))\n  write.csv(x = a, file = here::here(\"data\", paste0(locations[i], \".csv\")))\n}\n```\n:::\n\n\n### Ex. CPUE for all EBS and NBS stations with associated haul, cruise, and species information.\n\n\n::: {.cell tbl-cap='Ex.: CPUE for all EBS and NBS stations with associated haul, cruise, and species information. '}\n\n```{.r .cell-code}\na <- RODBC::sqlQuery(channel = channel, # NOT RACEBASE.HAUL\n                     query = paste0(\n                       \"\n-- Select columns for output data\nSELECT\ncr.CRUISEJOIN,\ncr.CRUISE,\ncr.YEAR,\ncr.SURVEY_DEFINITION_ID,\ncr.SURVEY_NAME,\ncr.VESSEL_ID,\ncr.VESSEL_NAME,\ncp.HAULJOIN,\ncp.SPECIES_CODE,\ntt.SPECIES_NAME,\ntt.COMMON_NAME,\ncp.WEIGHT_KG,\ncp.COUNT,\ncp.AREA_SWEPT_KM2,\ncp.CPUE_KGKM2,\ncp.CPUE_NOKM2,\nhh.HAUL,\nhh.STATION\n\n-- Identify what tables to pull data from\nFROM GAP_PRODUCTS.AKFIN_HAUL hh\nLEFT JOIN GAP_PRODUCTS.AKFIN_CRUISE cr\nON hh.CRUISEJOIN = cr.CRUISEJOIN\nLEFT JOIN GAP_PRODUCTS.AKFIN_CPUE cp\nON hh.HAULJOIN = cp.HAULJOIN\nLEFT JOIN GAP_PRODUCTS.TAXONOMIC_CLASSIFICATION tt\nON cp.SPECIES_CODE = tt.SPECIES_CODE\n\n-- Filter for EBS and NBS observations\nWHERE SURVEY_DEFINITION_ID IN (143, 98) -- 143 NBS, 98 EBS\nAND tt.SURVEY_SPECIES = 1\n\n-- Only return the first 3 rows because otherwise this would be a huge table!\nFETCH FIRST 3 ROWS ONLY;\")) \n\nflextable::flextable(head(a)) %>% \n  flextable::fit_to_width(max_width = 6) %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-68a6c284{}.cl-6893deda{font-family:'Arial';font-size:1pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6893dee4{font-family:'Arial';font-size:1pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-689af954{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-689af968{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-689b48aa{width:0.269in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48be{width:0.238in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48c8{width:0.223in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48c9{width:0.35in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48ca{width:0.544in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48d2{width:0.261in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48dc{width:0.287in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48e6{width:0.254in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48e7{width:0.293in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48f0{width:0.298in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48f1{width:0.269in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48f2{width:0.235in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48fa{width:0.316in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b48fb{width:0.28in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4904{width:0.281in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4905{width:0.222in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b490e{width:0.245in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b490f{width:0.269in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4918{width:0.238in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4919{width:0.223in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4922{width:0.35in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4923{width:0.544in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b492c{width:0.261in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b492d{width:0.287in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4936{width:0.254in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4937{width:0.293in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4938{width:0.298in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4940{width:0.269in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4941{width:0.235in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4942{width:0.316in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b494a{width:0.28in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b494b{width:0.281in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4954{width:0.222in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b495e{width:0.245in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b495f{width:0.269in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4968{width:0.238in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4969{width:0.223in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b496a{width:0.35in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4972{width:0.544in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4973{width:0.261in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b497c{width:0.287in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b497d{width:0.254in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4986{width:0.293in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4987{width:0.298in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4988{width:0.269in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4990{width:0.235in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b4991{width:0.316in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b499a{width:0.28in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b49a4{width:0.281in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b49ae{width:0.222in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-689b49af{width:0.245in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-68a6c284'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-689b48aa\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">CRUISEJOIN</span></p></th><th class=\"cl-689b48be\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">CRUISE</span></p></th><th class=\"cl-689b48c8\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">YEAR</span></p></th><th class=\"cl-689b48c9\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">SURVEY_DEFINITION_ID</span></p></th><th class=\"cl-689b48ca\"><p class=\"cl-689af968\"><span class=\"cl-6893deda\">SURVEY_NAME</span></p></th><th class=\"cl-689b48d2\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">VESSEL_ID</span></p></th><th class=\"cl-689b48dc\"><p class=\"cl-689af968\"><span class=\"cl-6893deda\">VESSEL_NAME</span></p></th><th class=\"cl-689b48e6\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">HAULJOIN</span></p></th><th class=\"cl-689b48e7\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">SPECIES_CODE</span></p></th><th class=\"cl-689b48e7\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">SPECIES_NAME</span></p></th><th class=\"cl-689b48f0\"><p class=\"cl-689af968\"><span class=\"cl-6893deda\">COMMON_NAME</span></p></th><th class=\"cl-689b48f1\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">WEIGHT_KG</span></p></th><th class=\"cl-689b48f2\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">COUNT</span></p></th><th class=\"cl-689b48fa\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">AREA_SWEPT_KM2</span></p></th><th class=\"cl-689b48fb\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">CPUE_KGKM2</span></p></th><th class=\"cl-689b4904\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">CPUE_NOKM2</span></p></th><th class=\"cl-689b4905\"><p class=\"cl-689af954\"><span class=\"cl-6893deda\">HAUL</span></p></th><th class=\"cl-689b490e\"><p class=\"cl-689af968\"><span class=\"cl-6893deda\">STATION</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-689b490f\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">80</span></p></td><td class=\"cl-689b4918\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">198,203</span></p></td><td class=\"cl-689b4919\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">1,982</span></p></td><td class=\"cl-689b4922\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">98</span></p></td><td class=\"cl-689b4923\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-689b492c\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">1</span></p></td><td class=\"cl-689b492d\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">CHAPMAN</span></p></td><td class=\"cl-689b4936\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">877</span></p></td><td class=\"cl-689b4937\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">1</span></p></td><td class=\"cl-689b4937\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\"></span></p></td><td class=\"cl-689b4938\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">fish egg unid.</span></p></td><td class=\"cl-689b4940\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b4941\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b4942\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0.042021</span></p></td><td class=\"cl-689b494a\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b494b\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b4954\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">21</span></p></td><td class=\"cl-689b495e\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">G-10</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-689b495f\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">80</span></p></td><td class=\"cl-689b4968\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">198,203</span></p></td><td class=\"cl-689b4969\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">1,982</span></p></td><td class=\"cl-689b496a\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">98</span></p></td><td class=\"cl-689b4972\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-689b4973\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">1</span></p></td><td class=\"cl-689b497c\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">CHAPMAN</span></p></td><td class=\"cl-689b497d\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">877</span></p></td><td class=\"cl-689b4986\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">2</span></p></td><td class=\"cl-689b4986\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\"></span></p></td><td class=\"cl-689b4987\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">fish larvae unid.</span></p></td><td class=\"cl-689b4988\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b4990\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b4991\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0.042021</span></p></td><td class=\"cl-689b499a\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b49a4\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b49ae\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">21</span></p></td><td class=\"cl-689b49af\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">G-10</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-689b490f\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">80</span></p></td><td class=\"cl-689b4918\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">198,203</span></p></td><td class=\"cl-689b4919\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">1,982</span></p></td><td class=\"cl-689b4922\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">98</span></p></td><td class=\"cl-689b4923\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-689b492c\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">1</span></p></td><td class=\"cl-689b492d\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">CHAPMAN</span></p></td><td class=\"cl-689b4936\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">877</span></p></td><td class=\"cl-689b4937\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">3</span></p></td><td class=\"cl-689b4937\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\"></span></p></td><td class=\"cl-689b4938\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">fish unid.</span></p></td><td class=\"cl-689b4940\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b4941\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b4942\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0.042021</span></p></td><td class=\"cl-689b494a\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b494b\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">0</span></p></td><td class=\"cl-689b4954\"><p class=\"cl-689af954\"><span class=\"cl-6893dee4\">21</span></p></td><td class=\"cl-689b495e\"><p class=\"cl-689af968\"><span class=\"cl-6893dee4\">G-10</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### Ex. CPUE for all stations contained in the INPFC Shumagin region (AREA_ID = 919) for Pacific cod. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- RODBC::sqlQuery(channel = channel,\n                       query =\n                         \"\n-- Select columns for output data\nSELECT \nHAULJOIN, \nSPECIES_CODE, \nSTRATUM, \nLATITUDE_DD_START, \nLONGITUDE_DD_START,\nCPUE_KGKM2, \nGEAR_TEMPERATURE_C\n\n-- Identify what tables to pull data from\nFROM GAP_PRODUCTS.AKFIN_CPUE cpue\nLEFT JOIN GAP_PRODUCTS.AKFIN_HAUL haul\nUSING (HAULJOIN) \n\n-- Filter for P. Cod observations\nWHERE SPECIES_CODE IN (21720)\n\n-- Select all stratum within the area_id 919 (INPFC Shumagin region)\nAND haul.STRATUM IN\n(\nSELECT \nSTRATUM\nFROM GAP_PRODUCTS.AKFIN_STRATUM_GROUPS \nWHERE AREA_ID = 919\n);\")\n```\n:::\n\n::: {.cell tbl-cap='Ex. 8: CPUE for all stations contained in the Shumagin region (AREA_ID = 919). '}\n\n```{.r .cell-code}\ndat <- dat %>% \n  dplyr::select(HAULJOIN, STRATUM, SPECIES_CODE, LATITUDE_DD_START, LONGITUDE_DD_START, CPUE_KGKM2, GEAR_TEMPERATURE_C) %>% \n  dplyr::mutate(SPECIES_CODE = as.character(SPECIES_CODE), \n                STRATUM = as.character(STRATUM)) %>% \n  dplyr::arrange(SPECIES_CODE)\n\nflextable::flextable(head(dat)) %>%   \n  flextable::fit_to_width(max_width = 6) %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-6c548ac4{}.cl-6c36ea3c{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6c36ea5a{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6c437004{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c437022{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c43a510{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c43a51a{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c43a51b{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c43a524{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c43a52e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c43a538{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-6c548ac4'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-6c43a510\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea3c\">HAULJOIN</span></p></th><th class=\"cl-6c43a51a\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea3c\">STRATUM</span></p></th><th class=\"cl-6c43a51a\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea3c\">SPECIES_CODE</span></p></th><th class=\"cl-6c43a510\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea3c\">LATITUDE_DD_START</span></p></th><th class=\"cl-6c43a510\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea3c\">LONGITUDE_DD_START</span></p></th><th class=\"cl-6c43a510\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea3c\">CPUE_KGKM2</span></p></th><th class=\"cl-6c43a510\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea3c\">GEAR_TEMPERATURE_C</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-22,147</span></p></td><td class=\"cl-6c43a524\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">11</span></p></td><td class=\"cl-6c43a524\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">21720</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">53.92966</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-164.6276</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">105.7733</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">4.3</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-22,119</span></p></td><td class=\"cl-6c43a538\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">111</span></p></td><td class=\"cl-6c43a538\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">21720</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">53.79215</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-165.3128</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">451.5863</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">4.5</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-22,107</span></p></td><td class=\"cl-6c43a524\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">12</span></p></td><td class=\"cl-6c43a524\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">21720</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">55.49881</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-161.5752</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">1,163.0550</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">5.2</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-22,099</span></p></td><td class=\"cl-6c43a538\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">12</span></p></td><td class=\"cl-6c43a538\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">21720</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">54.85306</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-162.9025</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">1,301.4142</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">4.5</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-22,153</span></p></td><td class=\"cl-6c43a524\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">11</span></p></td><td class=\"cl-6c43a524\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">21720</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">54.08538</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-163.3250</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">724.5604</span></p></td><td class=\"cl-6c43a51b\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">4.6</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-22,135</span></p></td><td class=\"cl-6c43a538\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">11</span></p></td><td class=\"cl-6c43a538\"><p class=\"cl-6c437022\"><span class=\"cl-6c36ea5a\">21720</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">54.42703</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">-162.4245</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">210.1829</span></p></td><td class=\"cl-6c43a52e\"><p class=\"cl-6c437004\"><span class=\"cl-6c36ea5a\">4.9</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### Ex. EBS Pacific Ocean perch CPUE and [`akgfmaps`](https://github.com/afsc-gap-products/akgfmaps) map \n\nPacific Ocean perch catch-per-unit-effort estimates for EBS in 2021 from `GAP_PRODUCTS.AKFIN_CPUE` and map constructed using [`akgfmaps`](https://github.com/afsc-gap-products/akgfmaps). Here, we'll use AKFIN HAUL and CRUISES data also included in this repo, for convenience, though they are very similar to their `RACEBASE` analogs. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- RODBC::sqlQuery(channel = channel, \n                       query = \n                         \"\n-- Select columns for output data\nSELECT \n(cp.CPUE_KGKM2/100) CPUE_KGHA, -- akgfmaps is expecting hectares\nhh.LATITUDE_DD_START LATITUDE,\nhh.LONGITUDE_DD_START LONGITUDE\n\n-- Use HAUL data to obtain LATITUDE & LONGITUDE and connect to cruisejoin\nFROM GAP_PRODUCTS.AKFIN_CPUE cp\nLEFT JOIN GAP_PRODUCTS.AKFIN_HAUL hh\nON cp.HAULJOIN = hh.HAULJOIN\n\n-- Use CRUISES data to obtain YEAR and SURVEY_DEFINITION_ID\nLEFT JOIN GAP_PRODUCTS.AKFIN_CRUISE cc\nON hh.CRUISEJOIN = cc.CRUISEJOIN\n\n-- Filter data\nWHERE cp.SPECIES_CODE = 30060 \nAND cc.SURVEY_DEFINITION_ID = 98 \nAND cc.YEAR = 2021;\")\n```\n:::\n\n::: {.cell tbl-cap='Ex. 6: EBS Pacific Ocean perch CPUE and [`akgfmaps`](https://github.com/afsc-gap-products/akgfmaps) map. '}\n\n```{.r .cell-code}\nflextable::flextable(head(dat)) %>%  \n  flextable::fit_to_width(max_width = 6) %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-6d6abfd2{}.cl-6d5cbc20{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6d5cbc34{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6d624528{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6d62638c{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6d626396{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6d626397{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-6d6abfd2'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-6d62638c\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc20\">CPUE_KGHA</span></p></th><th class=\"cl-6d62638c\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc20\">LATITUDE</span></p></th><th class=\"cl-6d62638c\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc20\">LONGITUDE</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6d626396\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">0</span></p></td><td class=\"cl-6d626396\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">58.00612</span></p></td><td class=\"cl-6d626396\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">-172.8205</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6d626397\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">0</span></p></td><td class=\"cl-6d626397\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">58.36181</span></p></td><td class=\"cl-6d626397\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">-172.3055</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6d626396\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">0</span></p></td><td class=\"cl-6d626396\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">60.68245</span></p></td><td class=\"cl-6d626396\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">-174.1275</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6d626397\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">0</span></p></td><td class=\"cl-6d626397\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">61.30959</span></p></td><td class=\"cl-6d626397\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">-173.5769</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6d626396\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">0</span></p></td><td class=\"cl-6d626396\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">58.97291</span></p></td><td class=\"cl-6d626396\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">-171.1306</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6d626397\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">0</span></p></td><td class=\"cl-6d626397\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">57.32779</span></p></td><td class=\"cl-6d626397\"><p class=\"cl-6d624528\"><span class=\"cl-6d5cbc34\">-171.4952</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# devtools::install_github(\"afsc-gap-products/akgfmaps\", build_vignettes = TRUE)\nlibrary(akgfmaps)\n\nfigure <- akgfmaps::make_idw_map(\n  x = dat, # Pass data as a data frame\n  region = \"bs.south\", # Predefined EBS area\n  set.breaks = \"jenks\", # Gets Jenks breaks from classint::classIntervals()\n  in.crs = \"+proj=longlat\", # Set input coordinate reference system\n  out.crs = \"EPSG:3338\", # Set output coordinate reference system\n  grid.cell = c(20000, 20000), # 20x20km grid\n  key.title = \"Pacific Ocean perch\") # Include in the legend title\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[inverse distance weighted interpolation]\n[inverse distance weighted interpolation]\n```\n:::\n\n```{.r .cell-code}\nfigure$plot + \n  ggplot2::guides(fill=guide_legend(title = \"Pacific Ocean perch\\nCPUE (kg/km2)\"))  |>   \n  change_fill_color(new.scheme = \"grey\", show.plot = FALSE)\n```\n\n::: {.cell-output-display}\n![Ex. 6: EBS Pacific Ocean perch CPUE and [`akgfmaps`](https://github.com/afsc-gap-products/akgfmaps) map. ](akfin-oracle-sql-r_files/figure-html/test-6-fig-1.png){width=672}\n:::\n:::\n\n\n### Ex. GOA Pacific Ocean perch biomass and abundance\n\nBiomass and abundance for Pacific Ocean perch from 1990 – 2023 for the western/central/eastern GOA management areas as well as for the entire region. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- RODBC::sqlQuery(channel = channel, \n                       query = \n                         \"\n-- Manipulate data to join to\nWITH FILTERED_STRATA AS (\nSELECT AREA_ID, DESCRIPTION FROM GAP_PRODUCTS.AKFIN_AREA\nWHERE AREA_TYPE in ('REGULATORY_AREA', 'REGION') \nAND SURVEY_DEFINITION_ID = 47)\n\n-- Select columns for output data\nSELECT \nBIOMASS_MT,\nPOPULATION_COUNT, \nYEAR, \nDESCRIPTION\n\n-- Identify what tables to pull data from\nFROM GAP_PRODUCTS.AKFIN_BIOMASS BIOMASS\nJOIN FILTERED_STRATA STRATA \nON STRATA.AREA_ID = BIOMASS.AREA_ID\n\n-- Filter data results\nWHERE BIOMASS.SPECIES_CODE = 30060\")\n```\n:::\n\n::: {.cell tbl-cap='Ex. 1: GOA Pacific Ocean perch biomass and abundance. '}\n\n```{.r .cell-code}\ndat0 <- dat %>% \n  janitor::clean_names() %>% \n  dplyr::select(biomass_mt, population_count, year, area = description) %>%\n  pivot_longer(cols = c(\"biomass_mt\", \"population_count\"), \n               names_to = \"var\", \n               values_to = \"val\") %>% \n  dplyr::mutate(\n    val = ifelse(var == \"biomass_mt\", val/1e6, val/1e9), \n    var = ifelse(var == \"biomass_mt\", \"Biomass (Mmt)\", \"Population (B)\"), \n    area = gsub(x = area, pattern = \" - \", replacement = \"\\n\"), \n    area = gsub(x = area, pattern = \": \", replacement = \"\\n\"), \n    type = sapply(X = strsplit(x = area, split = \"\\n\", fixed = TRUE), `[[`, 2))  %>% \n  dplyr::arrange(type) %>% \n  dplyr::mutate(\n    area = factor(area, levels = unique(area), labels = unique(area), ordered = TRUE))\n\nflextable::flextable(head(dat)) %>% \n  flextable::fit_to_width(max_width = 6) %>% \n  flextable::theme_zebra() %>%\n  flextable::colformat_num(x = ., j = \"YEAR\", big.mark = \"\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-779793c2{}.cl-778583a8{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-778583b2{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-778ba986{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-778ba9a4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-778be298{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-778be2a2{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-778be2ac{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-778be2ad{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-778be2b6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-778be2b7{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-779793c2'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-778be298\"><p class=\"cl-778ba986\"><span class=\"cl-778583a8\">BIOMASS_MT</span></p></th><th class=\"cl-778be298\"><p class=\"cl-778ba986\"><span class=\"cl-778583a8\">POPULATION_COUNT</span></p></th><th class=\"cl-778be298\"><p class=\"cl-778ba986\"><span class=\"cl-778583a8\">YEAR</span></p></th><th class=\"cl-778be2a2\"><p class=\"cl-778ba9a4\"><span class=\"cl-778583a8\">DESCRIPTION</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-778be2ac\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">157,295.1</span></p></td><td class=\"cl-778be2ac\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">317,129,408</span></p></td><td class=\"cl-778be2ac\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">1990</span></p></td><td class=\"cl-778be2ad\"><p class=\"cl-778ba9a4\"><span class=\"cl-778583b2\">GOA Region: All Strata</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-778be2b6\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">157,295.1</span></p></td><td class=\"cl-778be2b6\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">317,129,408</span></p></td><td class=\"cl-778be2b6\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">1990</span></p></td><td class=\"cl-778be2b7\"><p class=\"cl-778ba9a4\"><span class=\"cl-778583b2\">GOA Region: All Strata</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-778be2ac\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">483,622.6</span></p></td><td class=\"cl-778be2ac\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">833,902,161</span></p></td><td class=\"cl-778be2ac\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">1993</span></p></td><td class=\"cl-778be2ad\"><p class=\"cl-778ba9a4\"><span class=\"cl-778583b2\">GOA Region: All Strata</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-778be2b6\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">483,622.6</span></p></td><td class=\"cl-778be2b6\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">833,902,161</span></p></td><td class=\"cl-778be2b6\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">1993</span></p></td><td class=\"cl-778be2b7\"><p class=\"cl-778ba9a4\"><span class=\"cl-778583b2\">GOA Region: All Strata</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-778be2ac\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">771,412.8</span></p></td><td class=\"cl-778be2ac\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">1,252,616,603</span></p></td><td class=\"cl-778be2ac\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">1996</span></p></td><td class=\"cl-778be2ad\"><p class=\"cl-778ba9a4\"><span class=\"cl-778583b2\">GOA Region: All Strata</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-778be2b6\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">771,412.8</span></p></td><td class=\"cl-778be2b6\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">1,252,616,603</span></p></td><td class=\"cl-778be2b6\"><p class=\"cl-778ba986\"><span class=\"cl-778583b2\">1996</span></p></td><td class=\"cl-778be2b7\"><p class=\"cl-778ba9a4\"><span class=\"cl-778583b2\">GOA Region: All Strata</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"scales\")\nlibrary(scales)\nfigure <- ggplot2::ggplot(\n  dat = dat0, \n  mapping = aes(x = year, y = val, color = type)) +\n  ggplot2::geom_point(size = 3) + \n  ggplot2::facet_grid(cols = vars(area), rows = vars(var), scales = \"free_y\") + \n  ggplot2::scale_x_continuous(name = \"Year\", n.breaks = 3) +\n  ggplot2::scale_y_continuous(name = \"Estimate\", labels = comma) +\n  ggplot2::labs(title = 'GOA Pacific Ocean perch biomass and abundance 1990 – 2023')  + \n  ggplot2::guides(color=guide_legend(title = \"Region Type\"))+\n  ggplot2::scale_color_grey() +\n  ggplot2::theme_bw() +\n  ggplot2::theme(legend.direction = \"horizontal\", \n                 legend.position = \"bottom\")\n\nfigure\n```\n\n::: {.cell-output-display}\n![Ex. 1: GOA Pacific Ocean perch biomass and abundance. ](akfin-oracle-sql-r_files/figure-html/test-1-plot-1.png){width=672}\n:::\n:::\n\n\n### Ex. AI rock sole size compositions and ridge plot\n\nNorthern and Southern rock sole size composition data from 1991 – 2022 for the Aleutian Islands, with Ridge plot from [`ggridges`](https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- RODBC::sqlQuery(channel = channel, \n                       query = \n                         \"\n-- Manipulate data to join to\nWITH FILTERED_STRATA AS (\nSELECT \nAREA_ID, \nDESCRIPTION\n\n-- Identify what tables to pull data from\nFROM GAP_PRODUCTS.AKFIN_AREA\nWHERE AREA_TYPE = 'REGION' \nAND SURVEY_DEFINITION_ID = 52)\n\n-- Select columns for output data\nSELECT \nLENGTH_MM, \nYEAR\nFROM GAP_PRODUCTS.AKFIN_SIZECOMP SIZECOMP\nJOIN FILTERED_STRATA STRATA \nON STRATA.AREA_ID = SIZECOMP.AREA_ID\n\n-- Filter data results\nWHERE SIZECOMP.SURVEY_DEFINITION_ID IN 52 \nAND SIZECOMP.SPECIES_CODE IN (10261, 10262)\")\n```\n:::\n\n::: {.cell tbl-cap='Ex. 2: AI Rock sole size compositions and ridge plot. '}\n\n```{.r .cell-code}\ndat0 <- dat %>% \n  janitor::clean_names() %>% \n  dplyr::mutate(length_cm = length_mm/10) %>% \n  head() %>% \n  flextable::flextable() %>% \n  flextable::fit_to_width(max_width = 6) %>% \n  flextable::theme_zebra() %>%\n  flextable::colformat_num(x = ., j = \"year\", big.mark = \"\")\ndat0\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-78d128ca{}.cl-78b7aa44{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-78b7aa62{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-78c0ec3a{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-78c11598{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-78c115ac{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-78c115ad{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-78d128ca'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-78c11598\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa44\">length_mm</span></p></th><th class=\"cl-78c11598\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa44\">year</span></p></th><th class=\"cl-78c11598\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa44\">length_cm</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-78c115ac\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">170</span></p></td><td class=\"cl-78c115ac\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">2018</span></p></td><td class=\"cl-78c115ac\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">17</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-78c115ad\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">180</span></p></td><td class=\"cl-78c115ad\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">2018</span></p></td><td class=\"cl-78c115ad\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">18</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-78c115ac\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">190</span></p></td><td class=\"cl-78c115ac\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">2018</span></p></td><td class=\"cl-78c115ac\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">19</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-78c115ad\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">200</span></p></td><td class=\"cl-78c115ad\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">2018</span></p></td><td class=\"cl-78c115ad\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">20</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-78c115ac\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">210</span></p></td><td class=\"cl-78c115ac\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">2018</span></p></td><td class=\"cl-78c115ac\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">21</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-78c115ad\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">220</span></p></td><td class=\"cl-78c115ad\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">2018</span></p></td><td class=\"cl-78c115ad\"><p class=\"cl-78c0ec3a\"><span class=\"cl-78b7aa62\">22</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"ggridges\")\nlibrary(ggridges)\nfigure <- \n  ggplot2::ggplot(\n    data = dat, \n    mapping = aes(x = LENGTH_MM, y = as.factor(YEAR), fill = stat(x))) +\n  ggridges::theme_ridges(center_axis_labels = TRUE) + \n  ggridges::geom_density_ridges_gradient(scale = 4, show.legend = FALSE) + \n  ggplot2::scale_y_discrete(name = \"Year\", expand = c(0.01, 0)) +\n  ggplot2::scale_x_continuous(name = \"Length (cm)\", expand = c(0.01, 0)) +\n  # ggplot2::scale_fill_grey() +\n  ggplot2::labs(title = 'AI Rock sole Size Compositions 1991 – 2022') \n\nfigure\n```\n\n::: {.cell-output-display}\n![Ex. 2: AI Rock sole size compositions and ridge plot. ](akfin-oracle-sql-r_files/figure-html/test-2-plot-1.png){width=672}\n:::\n:::\n\n\n### Ex. EBS Walleye Pollock Age Compositions and Age Pyramid\n\nWalleye pollock age composition for the EBS Standard Area from 1982 – 2022 and the EBS + NW Area from 1987 – 2022, with age pyramid plot. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- RODBC::sqlQuery(channel = channel, \n                       query = \n                         \"\n-- Manipulate data to join to\nWITH FILTERED_STRATA AS (\nSELECT \nAREA_ID, \nDESCRIPTION \nFROM GAP_PRODUCTS.AKFIN_AREA\nWHERE AREA_TYPE = 'REGION' AND \nSURVEY_DEFINITION_ID = 98)\n\n-- Select columns for output data\nSELECT \nAGECOMP.AGE, \nAGECOMP.POPULATION_COUNT, \nAGECOMP.SEX\n\n-- Identify what tables to pull data from\nFROM GAP_PRODUCTS.AKFIN_AGECOMP AGECOMP\nJOIN FILTERED_STRATA STRATA \nON STRATA.AREA_ID = AGECOMP.AREA_ID\n\n-- Filter data results\nWHERE SPECIES_CODE = 21740\nAND AGE >= 0\")\n```\n:::\n\n::: {.cell tbl-cap='Ex. 3: EBS Walleye Pollock Age Compositions and Age Pyramid. '}\n\n```{.r .cell-code}\ndat0 <- dat %>% \n  janitor::clean_names() %>% \n  dplyr::filter(sex %in% c(1,2)) %>%\n  dplyr::mutate(\n    sex = ifelse(sex == 1, \"M\", \"F\"),\n    population_count = # change male population to negative\n      ifelse(sex==\"M\", population_count*(-1), population_count*1)/1e9) \n\nflextable::flextable(head(dat)) %>% \n  flextable::fit_to_width(max_width = 6) %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-7ad50894{}.cl-7ab8fb04{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7ab8fb18{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7ac436cc{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-7ac481e0{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7ac481fe{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7ac48208{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-7ad50894'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-7ac481e0\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb04\">AGE</span></p></th><th class=\"cl-7ac481e0\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb04\">POPULATION_COUNT</span></p></th><th class=\"cl-7ac481e0\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb04\">SEX</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7ac481fe\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">1</span></p></td><td class=\"cl-7ac481fe\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">109,712,069</span></p></td><td class=\"cl-7ac481fe\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">2</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7ac48208\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">2</span></p></td><td class=\"cl-7ac48208\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">206,608,351</span></p></td><td class=\"cl-7ac48208\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">2</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7ac481fe\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">3</span></p></td><td class=\"cl-7ac481fe\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">464,458,137</span></p></td><td class=\"cl-7ac481fe\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">2</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7ac48208\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">4</span></p></td><td class=\"cl-7ac48208\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">237,658,858</span></p></td><td class=\"cl-7ac48208\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">2</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7ac481fe\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">5</span></p></td><td class=\"cl-7ac481fe\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">235,969,541</span></p></td><td class=\"cl-7ac481fe\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">2</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7ac48208\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">6</span></p></td><td class=\"cl-7ac48208\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">166,817,093</span></p></td><td class=\"cl-7ac48208\"><p class=\"cl-7ac436cc\"><span class=\"cl-7ab8fb18\">2</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfigure <- ggplot2::ggplot(\n  data = dat0, \n  mapping = \n    aes(x = age,\n        y = population_count, \n        fill = sex)) +\n  ggplot2::scale_fill_grey() +\n  ggplot2::geom_bar(stat = \"identity\") +\n  ggplot2::coord_flip() +\n  ggplot2::scale_x_continuous(name = \"Age\") +\n  ggplot2::scale_y_continuous(name = \"Population (billions)\", labels = abs) +\n  ggplot2::ggtitle(label = \"EBS Walleye Pollock Age Compositions 1982 – 2022\")  + \n  ggplot2::guides(fill = guide_legend(title = \"Sex\"))+\n  ggplot2::theme_bw()\n\nfigure\n```\n\n::: {.cell-output-display}\n![Ex. 3: EBS Walleye Pollock Age Compositions and Age Pyramid. ](akfin-oracle-sql-r_files/figure-html/test-3-plot-1.png){width=672}\n:::\n:::\n\n\n### Ex. NBS Pacific cod biomass and abundance\n\nPacific cod biomass and abundance data for the NBS by stratum. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- RODBC::sqlQuery(channel = channel, \n                       query = \n                         \"\n-- Manipulate data to join to\nWITH FILTERED_STRATA AS (\nSELECT \nAREA_ID, \nAREA_NAME, \nDESCRIPTION \nFROM GAP_PRODUCTS.AKFIN_AREA\nWHERE AREA_TYPE in ('STRATUM') AND \nSURVEY_DEFINITION_ID = 143) \n\n-- Select columns for output data\nSELECT \nBIOMASS.BIOMASS_MT, \nBIOMASS.POPULATION_COUNT, \nBIOMASS.YEAR, \nSTRATA.AREA_NAME\n\n-- Identify what tables to pull data from\nFROM GAP_PRODUCTS.AKFIN_BIOMASS BIOMASS \nJOIN FILTERED_STRATA STRATA \nON STRATA.AREA_ID = BIOMASS.AREA_ID\n\n-- Filter data results\nWHERE BIOMASS.SURVEY_DEFINITION_ID IN 143 \nAND BIOMASS.SPECIES_CODE = 21720\")\n```\n:::\n\n::: {.cell tbl-cap='Ex. 4: NBS Pacific cod biomass and abundance. '}\n\n```{.r .cell-code}\ndat0 <- dat %>% \n  janitor::clean_names() %>% \n  dplyr::select(biomass_mt, population_count, year, area = area_name) %>%\n  pivot_longer(cols = c(\"biomass_mt\", \"population_count\"), \n               names_to = \"var\", \n               values_to = \"val\") %>% \n  dplyr::mutate(\n    val = ifelse(var == \"biomass_mt\", val/1e6, val/1e9), \n    var = ifelse(var == \"biomass_mt\", \"Biomass (Mmt)\", \"Population (B)\"), \n    area = factor(area, levels = unique(area), labels = unique(area), ordered = TRUE))\nflextable::flextable(head(dat)) %>% \n  flextable::fit_to_width(max_width = 6) %>% \n  flextable::theme_zebra() %>%\n  flextable::colformat_num(x = ., j = \"YEAR\", big.mark = \"\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-7cb1fb36{}.cl-7c901cf0{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7c901d0e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7c9e6616{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-7c9e6634{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-7c9eb27e{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7c9eb29c{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7c9eb2a6{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7c9eb2b0{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7c9eb2ba{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7c9eb2bb{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-7cb1fb36'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-7c9eb27e\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901cf0\">BIOMASS_MT</span></p></th><th class=\"cl-7c9eb27e\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901cf0\">POPULATION_COUNT</span></p></th><th class=\"cl-7c9eb27e\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901cf0\">YEAR</span></p></th><th class=\"cl-7c9eb29c\"><p class=\"cl-7c9e6634\"><span class=\"cl-7c901cf0\">AREA_NAME</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7c9eb2a6\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">7,089.874</span></p></td><td class=\"cl-7c9eb2a6\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">4,191,118</span></p></td><td class=\"cl-7c9eb2a6\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">2017</span></p></td><td class=\"cl-7c9eb2b0\"><p class=\"cl-7c9e6634\"><span class=\"cl-7c901d0e\">Middle Domain</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7c9eb2ba\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">7,089.874</span></p></td><td class=\"cl-7c9eb2ba\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">4,191,118</span></p></td><td class=\"cl-7c9eb2ba\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">2017</span></p></td><td class=\"cl-7c9eb2bb\"><p class=\"cl-7c9e6634\"><span class=\"cl-7c901d0e\">Middle Domain</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7c9eb2a6\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">7,089.874</span></p></td><td class=\"cl-7c9eb2a6\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">4,191,118</span></p></td><td class=\"cl-7c9eb2a6\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">2017</span></p></td><td class=\"cl-7c9eb2b0\"><p class=\"cl-7c9e6634\"><span class=\"cl-7c901d0e\">Middle Domain</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7c9eb2ba\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">7,089.874</span></p></td><td class=\"cl-7c9eb2ba\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">4,191,118</span></p></td><td class=\"cl-7c9eb2ba\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">2017</span></p></td><td class=\"cl-7c9eb2bb\"><p class=\"cl-7c9e6634\"><span class=\"cl-7c901d0e\">Middle Domain</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7c9eb2a6\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">7,089.874</span></p></td><td class=\"cl-7c9eb2a6\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">4,191,118</span></p></td><td class=\"cl-7c9eb2a6\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">2017</span></p></td><td class=\"cl-7c9eb2b0\"><p class=\"cl-7c9e6634\"><span class=\"cl-7c901d0e\">Middle Domain</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7c9eb2ba\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">30,487.278</span></p></td><td class=\"cl-7c9eb2ba\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">15,157,597</span></p></td><td class=\"cl-7c9eb2ba\"><p class=\"cl-7c9e6616\"><span class=\"cl-7c901d0e\">2022</span></p></td><td class=\"cl-7c9eb2bb\"><p class=\"cl-7c9e6634\"><span class=\"cl-7c901d0e\">Middle Domain</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfigure <- ggplot2::ggplot(\n  dat = dat0, \n  mapping = aes(y = val, x = year, fill = area))  + \n  ggplot2::geom_bar(position=\"stack\", stat=\"identity\") +  \n  ggplot2::facet_grid(rows = vars(var), scales = \"free_y\") +\n  ggplot2::scale_y_continuous(name = \"Estimate\", labels = comma) +\n  ggplot2::scale_x_continuous(name = \"Year\", breaks = unique(dat0$year)) +\n  ggplot2::labs(title = 'NBS Pacific cod biomass and abundance by stratum')  + \n  ggplot2::guides(fill=guide_legend(title = \"Region Type\"))+\n  ggplot2::scale_fill_grey() +\n  ggplot2::theme_bw() +\n  ggplot2::theme(legend.direction = \"horizontal\", \n                 legend.position = \"bottom\")\n\nfigure\n```\n\n::: {.cell-output-display}\n![Ex. 4: NBS Pacific cod biomass and abundance. ](akfin-oracle-sql-r_files/figure-html/test-4-fig-1.png){width=672}\n:::\n:::\n\n\n### Ex. GOA Pacific Ocean perch biomass and line plot\n\nPacific Ocean perch biomass totals for GOA between 1984-2021 from `GAP_PRODUCTS.AKFIN_BIOMASS`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- RODBC::sqlQuery(channel = channel, \n                       query = \n                         \"\n-- Select columns for output data\nSELECT \nSURVEY_DEFINITION_ID, \nBIOMASS_MT, \nBIOMASS_VAR, \nYEAR\n\n-- Identify what tables to pull data from\nFROM GAP_PRODUCTS.AKFIN_BIOMASS\n\n-- Filter data results\nWHERE SPECIES_CODE = 30060 \nAND SURVEY_DEFINITION_ID = 47 \nAND AREA_ID = 99903 \nAND YEAR BETWEEN 1984 AND 2023;\") %>% \n  janitor::clean_names() %>% \n  dplyr::mutate(biomass_kmt = biomass_mt/1000, \n                # **approximate** 95% confidence interval\n                biomass_kci_up = (biomass_mt + (2*sqrt(biomass_var)))/1000, \n                biomass_kci_dw = (biomass_mt - (2*sqrt(biomass_var)))/1000) \n```\n:::\n\n::: {.cell tbl-cap='Ex. 5: GOA Pacific Ocean perch biomass and line plot. '}\n\n```{.r .cell-code}\nflextable::flextable(head(dat)) %>%\n  flextable::fit_to_width(max_width = 6) %>% \n  flextable::theme_zebra() %>%\n  flextable::colformat_num(x = ., j = \"year\", big.mark = \"\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-7e56b472{}.cl-7e330b94{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7e330bb2{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-7e413228{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-7e4181f6{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7e418214{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-7e41821e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-7e56b472'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-7e4181f6\"><p class=\"cl-7e413228\"><span class=\"cl-7e330b94\">survey_definition_id</span></p></th><th class=\"cl-7e4181f6\"><p class=\"cl-7e413228\"><span class=\"cl-7e330b94\">biomass_mt</span></p></th><th class=\"cl-7e4181f6\"><p class=\"cl-7e413228\"><span class=\"cl-7e330b94\">biomass_var</span></p></th><th class=\"cl-7e4181f6\"><p class=\"cl-7e413228\"><span class=\"cl-7e330b94\">year</span></p></th><th class=\"cl-7e4181f6\"><p class=\"cl-7e413228\"><span class=\"cl-7e330b94\">biomass_kmt</span></p></th><th class=\"cl-7e4181f6\"><p class=\"cl-7e413228\"><span class=\"cl-7e330b94\">biomass_kci_up</span></p></th><th class=\"cl-7e4181f6\"><p class=\"cl-7e413228\"><span class=\"cl-7e330b94\">biomass_kci_dw</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">47</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">157,295.1</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">2,221,176,968</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">1990</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">157.2951</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">251.5538</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">63.03638</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">47</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">483,622.6</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">11,803,384,787</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">1993</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">483.6226</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">700.9093</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">266.33581</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">47</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">771,412.8</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">41,434,152,202</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">1996</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">771.4128</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">1,178.5204</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">364.30515</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">47</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">727,063.5</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">150,983,542,178</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">1999</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">727.0635</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">1,504.1955</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">-50.06854</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">47</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">673,155.1</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">49,285,342,922</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">2001</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">673.1551</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">1,117.1611</span></p></td><td class=\"cl-7e418214\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">229.14901</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">47</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">457,421.6</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">5,186,126,529</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">2003</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">457.4216</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">601.4511</span></p></td><td class=\"cl-7e41821e\"><p class=\"cl-7e413228\"><span class=\"cl-7e330bb2\">313.39204</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\na_mean <- dat %>% \n  dplyr::group_by(survey_definition_id) %>% \n  dplyr::summarise(biomass_kmt = mean(biomass_kmt, na.rm = TRUE), \n                   minyr = min(year, na.rm = TRUE), \n                   maxyr = max(year, na.rm = TRUE)) \n\nfigure <-\n  ggplot(data = dat, \n         mapping = aes(x = year, \n                       y = biomass_kmt)) +\n  ggplot2::geom_point(size = 2.5, color = \"grey40\") + \n  ggplot2::scale_x_continuous(\n    name = \"Year\", \n    labels = scales::label_number(\n      accuracy = 1, \n      big.mark = \"\"))   +\n  ggplot2::scale_y_continuous(\n    name = \"Biomass (Kmt)\", \n    labels = comma) +\n  ggplot2::geom_segment(\n    data = a_mean,\n    mapping = aes(x = minyr, \n                  xend = maxyr, \n                  y = biomass_kmt, \n                  yend = biomass_kmt),\n    linetype = \"dashed\", \n    linewidth = 2) +\n  ggplot2::geom_errorbar(\n    mapping = aes(ymin = biomass_kci_dw, ymax = biomass_kci_up),\n    position = position_dodge(.9),\n    alpha = 0.5, width=.2) +\n  ggplot2::ggtitle(\n    label = \"GOA Pacific Ocean Perch Biomass 1984-2021\", \n    subtitle = paste0(\"Mean = \", \n                      formatC(x = a_mean$biomass_kmt, \n                              digits = 2, \n                              big.mark = \",\", \n                              format = \"f\"), \n                      \" Kmt\")) +\n  ggplot2::theme_bw()\n\nfigure\n```\n\n::: {.cell-output-display}\n![Ex. 5: GOA Pacific Ocean perch biomass and line plot. ](akfin-oracle-sql-r_files/figure-html/test-5-fig-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "akfin-oracle-sql-r_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/tabwid-1.1.3/tabwid.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}