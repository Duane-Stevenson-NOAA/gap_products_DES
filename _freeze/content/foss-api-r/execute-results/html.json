{
  "hash": "b8bf2d78342e28abfcc02bc505cc1919",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Access via API and R\nnumber-sections: true\n---\n\n\n\n\n\n\n**An application programming interface (API) is a way for two or more computer programs to communicate with each other.** More information about how to amend API links can be found [here](https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/22.3/books.html#AELIG90103/). Useful introductions to using APIs in `R` can be found [here](https://www.dataquest.io/blog/r-api-tutorial/). \n\nThere are three tables the user can pull from the API. Learn more about them on the [FOSS data description page](https://afsc-gap-products.github.io/gap_products/content/foss-metadata.html). Here, you can see them in their raw JSON format:\n\n* haul: [https://apps-st.fisheries.noaa.gov/ods/foss/afsc_groundfish_survey_haul/](https://apps-st.fisheries.noaa.gov/ods/foss/afsc_groundfish_survey_haul/)\n* catch: [https://apps-st.fisheries.noaa.gov/ods/foss/afsc_groundfish_survey_catch/](https://apps-st.fisheries.noaa.gov/ods/foss/afsc_groundfish_survey_catch/)\n* species: [https://apps-st.fisheries.noaa.gov/ods/foss/afsc_groundfish_survey_species/](https://apps-st.fisheries.noaa.gov/ods/foss/afsc_groundfish_survey_species/)\n\nHere are some examples of how to use the data with R:\n\n## Ex. Load all rows of the catch, haul, and species data tables\n\nNote that without specifying, a basic query to the API will only return 25 entries. \n\n### Load haul data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# link to the API\napi_link_haul <- 'https://apps-st.fisheries.noaa.gov/ods/foss/afsc_groundfish_survey_haul/'\n```\n:::\n\n::: {.cell inlcude='false'}\n\n:::\n\n\n#### Load first 25 rows of data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- httr::GET(url = api_link_haul)\n# res ## Test connection\n\n## convert from JSON format\ndat <- jsonlite::fromJSON(base::rawToChar(res$content))$items\n\n# Find how many rows and columns are in the data pull\nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 25; cols: 28\"\n```\n\n\n:::\n:::\n\n\n#### Load all data:\n\nSince the maxim number of rows a user can pull is 10,000 rows in a query, the user needs to cycle through by `offsetting` to the next 10,000 rows (as is shown here). \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- data.frame()\nfor (i in seq(0, 500000, 10000)){\n  ## find how many iterations it takes to cycle through the data\n  print(i)\n  ## query the API link\n  res <- httr::GET(url = paste0(api_link_haul, \"?offset=\",i,\"&limit=10000\"))\n  ## convert from JSON format\n  data <- jsonlite::fromJSON(base::rawToChar(res$content)) \n  \n  ## if there are no data, stop the loop\n  if (is.null(nrow(data$items))) {\n    break\n  }\n  \n  ## bind sub-pull to dat data.frame\n  dat <- dplyr::bind_rows(dat, \n                          data$items %>%\n                            dplyr::select(-links)) # necessary for API accounting, but not part of the dataset)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n[1] 10000\n[1] 20000\n[1] 30000\n[1] 40000\n```\n\n\n:::\n:::\n\n\nExplore the data contents:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find how many rows and columns are in the data pull\nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 33991; cols: 27\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# learn about the structure of the data\nsummary(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      year          srvy              survey          survey_name       \n Min.   :1982   Length:33991       Length:33991       Length:33991      \n 1st Qu.:1997   Class :character   Class :character   Class :character  \n Median :2006   Mode  :character   Mode  :character   Mode  :character  \n Mean   :2005                                                           \n 3rd Qu.:2015                                                           \n Max.   :2024                                                           \n                                                                        \n survey_definition_id     cruise         cruisejoin         hauljoin      \n Min.   : 47.00       Min.   :198201   Min.   :   -770   Min.   : -23911  \n 1st Qu.: 47.00       1st Qu.:199701   1st Qu.:   -697   1st Qu.: -14104  \n Median : 78.00       Median :200601   Median :   -616   Median :  -4314  \n Mean   : 74.55       Mean   :200543   Mean   : 294616   Mean   : 289722  \n 3rd Qu.: 98.00       3rd Qu.:201501   3rd Qu.: 837799   3rd Qu.: 816124  \n Max.   :143.00       Max.   :202401   Max.   :1225395   Max.   :1225635  \n                                                                          \n      haul          stratum        station            vessel_id    \n Min.   :  1.0   Min.   : 10.0   Length:33991       Min.   :  1.0  \n 1st Qu.: 56.0   1st Qu.: 31.0   Class :character   1st Qu.: 88.0  \n Median :112.0   Median : 50.0   Mode  :character   Median : 94.0  \n Mean   :117.3   Mean   :130.9                      Mean   :107.8  \n 3rd Qu.:170.0   3rd Qu.:142.0                      3rd Qu.:147.0  \n Max.   :355.0   Max.   :794.0                      Max.   :178.0  \n                                                                   \n vessel_name         date_time         latitude_dd_start longitude_dd_start\n Length:33991       Length:33991       Min.   :51.19     Min.   :-180.0    \n Class :character   Class :character   1st Qu.:55.00     1st Qu.:-170.7    \n Mode  :character   Mode  :character   Median :57.16     Median :-165.3    \n                                       Mean   :56.86     Mean   :-139.6    \n                                       3rd Qu.:58.97     3rd Qu.:-154.4    \n                                       Max.   :65.34     Max.   : 180.0    \n                                                                           \n latitude_dd_end longitude_dd_end bottom_temperature_c surface_temperature_c\n Min.   :51.19   Min.   :-180.0   Min.   :-2.100       Min.   :-1.100       \n 1st Qu.:55.00   1st Qu.:-170.7   1st Qu.: 2.700       1st Qu.: 5.800       \n Median :57.16   Median :-165.3   Median : 4.100       Median : 7.400       \n Mean   :56.86   Mean   :-139.6   Mean   : 3.829       Mean   : 7.794       \n 3rd Qu.:58.96   3rd Qu.:-154.4   3rd Qu.: 5.200       3rd Qu.: 9.300       \n Max.   :65.35   Max.   : 180.0   Max.   :15.300       Max.   :18.100       \n NA's   :4       NA's   :4        NA's   :1601         NA's   :852          \n    depth_m       distance_fished_km  duration_hr      net_width_m   \n Min.   :   9.0   Min.   :0.135      Min.   :0.0250   Min.   : 7.51  \n 1st Qu.:  68.0   1st Qu.:1.497      1st Qu.:0.2710   1st Qu.:15.58  \n Median : 102.0   Median :2.528      Median :0.4900   Median :16.40  \n Mean   : 137.8   Mean   :2.206      Mean   :0.4006   Mean   :16.42  \n 3rd Qu.: 156.0   3rd Qu.:2.833      3rd Qu.:0.5090   3rd Qu.:17.21  \n Max.   :1200.0   Max.   :4.334      Max.   :0.9800   Max.   :23.82  \n                                                                     \n  net_height_m    area_swept_km2      performance    \n Min.   : 0.000   Min.   :0.002314   Min.   :0.0000  \n 1st Qu.: 2.383   1st Qu.:0.024261   1st Qu.:0.0000  \n Median : 5.865   Median :0.039562   Median :0.0000  \n Mean   : 4.822   Mean   :0.036378   Mean   :0.2779  \n 3rd Qu.: 6.788   3rd Qu.:0.047280   3rd Qu.:0.0000  \n Max.   :11.038   Max.   :0.077795   Max.   :7.0000  \n NA's   :3269                                        \n```\n\n\n:::\n\n```{.r .cell-code}\n# Print the first few lines of the data \ndat %>% \n  head(3) %>% \n  flextable::flextable() %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"year\", \"cruise\", \"cruisejoin\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-191d7364{}.cl-190bc268{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-190bc286{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-19127e96{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-19127ea0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-1912bcb2{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1912bcbc{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1912bcc6{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1912bcda{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1912bcdb{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1912bce4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-191d7364'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">year</span></p></th><th class=\"cl-1912bcbc\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc268\">srvy</span></p></th><th class=\"cl-1912bcbc\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc268\">survey</span></p></th><th class=\"cl-1912bcbc\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc268\">survey_name</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">survey_definition_id</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">cruise</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">cruisejoin</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">hauljoin</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">haul</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">stratum</span></p></th><th class=\"cl-1912bcbc\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc268\">station</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">vessel_id</span></p></th><th class=\"cl-1912bcbc\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc268\">vessel_name</span></p></th><th class=\"cl-1912bcbc\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc268\">date_time</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">latitude_dd_start</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">longitude_dd_start</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">latitude_dd_end</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">longitude_dd_end</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">bottom_temperature_c</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">surface_temperature_c</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">depth_m</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">distance_fished_km</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">duration_hr</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">net_width_m</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">net_height_m</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">area_swept_km2</span></p></th><th class=\"cl-1912bcb2\"><p class=\"cl-19127e96\"><span class=\"cl-190bc268\">performance</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">1998</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">EBS</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">eastern Bering Sea</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">98</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">199801</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">937213</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">937,531</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">125</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">41</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">J-23</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">89</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">ALDEBARAN</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">1998-07-13T11:29:00Z</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">57.99293</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">-171.5905</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">58.01870</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">-171.5921</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">3.0</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">7.9</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">98</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">2.869</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">0.52</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">18.360</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">1.840</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">0.052675</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">0</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">1998</span></p></td><td class=\"cl-1912bce4\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">EBS</span></p></td><td class=\"cl-1912bce4\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">eastern Bering Sea</span></p></td><td class=\"cl-1912bce4\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">98</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">199801</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">937213</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">937,532</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">126</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">42</span></p></td><td class=\"cl-1912bce4\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">J-22</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">89</span></p></td><td class=\"cl-1912bce4\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">ALDEBARAN</span></p></td><td class=\"cl-1912bce4\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">1998-07-13T14:12:00Z</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">57.99357</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">-170.9699</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">58.01933</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">-170.9711</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">2.5</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">8.1</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">87</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">2.867</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">0.51</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">18.254</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">1.884</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">0.052334</span></p></td><td class=\"cl-1912bcdb\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">0</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">1998</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">EBS</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">eastern Bering Sea</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">98</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">199801</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">937213</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">937,533</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">127</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">41</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">K-22</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">89</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">ALDEBARAN</span></p></td><td class=\"cl-1912bcda\"><p class=\"cl-19127ea0\"><span class=\"cl-190bc286\">1998-07-13T16:41:00Z</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">58.32213</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">-171.0066</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">58.34687</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">-171.0160</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">2.1</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">8.2</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">84</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">2.808</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">0.52</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">18.471</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">1.770</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">0.051867</span></p></td><td class=\"cl-1912bcc6\"><p class=\"cl-19127e96\"><span class=\"cl-190bc286\">0</span></p></td></tr></tbody></table></div>\n```\n\n:::\n\n```{.r .cell-code}\n# save outputs for later comparison\ndat_haul_api <- dat\n```\n:::\n\n\n### Load catch data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# link to the API\napi_link_catch <- 'https://apps-st.fisheries.noaa.gov/ods/foss/afsc_groundfish_survey_catch/'\n```\n:::\n\n::: {.cell inlcude='false'}\n\n:::\n\n\n#### Load first 25 rows of data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- httr::GET(url = api_link_catch)\n# res ## Test connection\n\n## convert from JSON format\ndat <- jsonlite::fromJSON(base::rawToChar(res$content))$items\n\n# Find how many rows and columns are in the data pull\nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 25; cols: 8\"\n```\n\n\n:::\n:::\n\n\n#### Load all data\n\nSince the maxim number of rows a user can pull is 10,000 rows in a query, the user needs to cycle through by `offsetting` to the next 10,000 rows (as is shown here). \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- data.frame()\n# for (i in seq(0, 100000, 10000)){\nfor (i in seq(0, 1000000, 10000)){\n  ## find how many iterations it takes to cycle through the data\n  # print(i)\n  ## query the API link\n  res <- httr::GET(url = paste0(api_link_catch, \"?offset=\",i,\"&limit=10000\"))\n  ## convert from JSON format\n  data <- jsonlite::fromJSON(base::rawToChar(res$content)) \n  \n  ## if there are no data, stop the loop\n  if (is.null(nrow(data$items))) {\n    break\n  }\n  \n  ## bind sub-pull to dat data.frame\n  dat <- dplyr::bind_rows(dat, \n                          data$items %>%\n                            dplyr::select(-links)) # necessary for API accounting, but not part of the dataset)\n}\n```\n:::\n\n\nExplore the data contents:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find how many rows and columns are in the data pull\nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 890349; cols: 7\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# learn about the structure of the data\nsummary(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    hauljoin        species_code     cpue_kgkm2        cpue_nokm2      \n Min.   : -23911   Min.   :    1   Min.   :      0   Min.   :      13  \n 1st Qu.: -14398   1st Qu.:20510   1st Qu.:      6   1st Qu.:      58  \n Median :  -5225   Median :40500   Median :     49   Median :     213  \n Mean   : 281196   Mean   :45121   Mean   :   1253   Mean   :    4618  \n 3rd Qu.: 802468   3rd Qu.:71800   3rd Qu.:    375   3rd Qu.:    1134  \n Max.   :1225635   Max.   :99999   Max.   :3226235   Max.   :21780780  \n                                                     NA's   :89147     \n     count          weight_kg         taxon_confidence  \n Min.   :     1   Min.   :    0.001   Length:890349     \n 1st Qu.:     2   1st Qu.:    0.200   Class :character  \n Median :     8   Median :    1.814   Mode  :character  \n Mean   :   181   Mean   :   41.827                     \n 3rd Qu.:    43   3rd Qu.:   13.900                     \n Max.   :867119   Max.   :18187.700                     \n NA's   :89147                                          \n```\n\n\n:::\n\n```{.r .cell-code}\n# Print the first few lines of the data \ndat %>% \n  head(3) %>% \n  flextable::flextable() %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"species_code\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-da4b5952{}.cl-da3b6e34{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-da3b6e48{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-da417a72{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-da417a86{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-da41b05a{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da41b06e{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da41b078{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da41b082{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da41b083{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da41b08c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-da4b5952'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-da41b05a\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e34\">hauljoin</span></p></th><th class=\"cl-da41b05a\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e34\">species_code</span></p></th><th class=\"cl-da41b05a\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e34\">cpue_kgkm2</span></p></th><th class=\"cl-da41b05a\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e34\">cpue_nokm2</span></p></th><th class=\"cl-da41b05a\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e34\">count</span></p></th><th class=\"cl-da41b05a\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e34\">weight_kg</span></p></th><th class=\"cl-da41b06e\"><p class=\"cl-da417a86\"><span class=\"cl-da3b6e34\">taxon_confidence</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">-20,640</span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">69086</span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">447.003231</span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">4,735.5788</span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">214</span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">20.200</span></p></td><td class=\"cl-da41b082\"><p class=\"cl-da417a86\"><span class=\"cl-da3b6e48\">High</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-da41b083\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">-20,640</span></p></td><td class=\"cl-da41b083\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">69095</span></p></td><td class=\"cl-da41b083\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">7.435301</span></p></td><td class=\"cl-da41b083\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">265.5465</span></p></td><td class=\"cl-da41b083\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">12</span></p></td><td class=\"cl-da41b083\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">0.336</span></p></td><td class=\"cl-da41b08c\"><p class=\"cl-da417a86\"><span class=\"cl-da3b6e48\">High</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">-20,640</span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">71001</span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">33.082665</span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\"></span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\"></span></p></td><td class=\"cl-da41b078\"><p class=\"cl-da417a72\"><span class=\"cl-da3b6e48\">1.495</span></p></td><td class=\"cl-da41b082\"><p class=\"cl-da417a86\"><span class=\"cl-da3b6e48\"></span></p></td></tr></tbody></table></div>\n```\n\n:::\n\n```{.r .cell-code}\n# save outputs for later comparison\ndat_catch_api <- dat\n```\n:::\n\n\n### Load species data\n\nSince there are less than 10,000 rows of species data (and the maxim number of rows a user can pull from this API is 10,000 rows in a query), we can simply call `?offset=0&limit=10000` in our query call. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# link to the API\napi_link_species <- 'https://apps-st.fisheries.noaa.gov/ods/foss/afsc_groundfish_survey_species/'\n```\n:::\n\n::: {.cell inlcude='false'}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- httr::GET(url = paste0(api_link_species, \"?offset=0&limit=10000\"))\n\n## convert from JSON format\ndata <- jsonlite::fromJSON(base::rawToChar(res$content))\ndat <- data$items  %>%\n  dplyr::select(-links) # necessary for API accounting, but not part of the dataset\n```\n:::\n\n\nExplore the data contents:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find how many rows and columns are in the data pull\nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 1894; cols: 6\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# learn about the structure of the data\nsummary(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  species_code   scientific_name    common_name          id_rank         \n Min.   :    1   Length:1894        Length:1894        Length:1894       \n 1st Qu.:30105   Class :character   Class :character   Class :character  \n Median :70061   Mode  :character   Mode  :character   Mode  :character  \n Mean   :58788                                                           \n 3rd Qu.:80543                                                           \n Max.   :99999                                                           \n                                                                         \n     worms              itis        \n Min.   :     51   Min.   :  46861  \n 1st Qu.: 134297   1st Qu.:  79427  \n Median : 254545   Median : 157164  \n Mean   : 314551   Mean   : 210096  \n 3rd Qu.: 369147   3rd Qu.: 167414  \n Max.   :1757986   Max.   :1206057  \n NA's   :225       NA's   :389      \n```\n\n\n:::\n\n```{.r .cell-code}\n# Print the first few lines of the data \ndat %>% \n  head(3) %>% \n  flextable::flextable() %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"species_code\", \"worms\", \"itis\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-db0c824e{}.cl-dafd7f2e{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-dafd7f42{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-db0326a4{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-db0326b8{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-db0358a4{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-db0358b8{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-db0358b9{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-db0358c2{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-db0358c3{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-db0358c4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-db0c824e'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-db0358a4\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f2e\">species_code</span></p></th><th class=\"cl-db0358b8\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f2e\">scientific_name</span></p></th><th class=\"cl-db0358b8\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f2e\">common_name</span></p></th><th class=\"cl-db0358b8\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f2e\">id_rank</span></p></th><th class=\"cl-db0358a4\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f2e\">worms</span></p></th><th class=\"cl-db0358a4\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f2e\">itis</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-db0358b9\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f42\">10130</span></p></td><td class=\"cl-db0358c2\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f42\">Hippoglossoides elassodon</span></p></td><td class=\"cl-db0358c2\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f42\">flathead sole</span></p></td><td class=\"cl-db0358c2\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f42\">species</span></p></td><td class=\"cl-db0358b9\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f42\">274289</span></p></td><td class=\"cl-db0358b9\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f42\">172875</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-db0358c3\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f42\">20731</span></p></td><td class=\"cl-db0358c4\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f42\">Rathbunella hypoplecta</span></p></td><td class=\"cl-db0358c4\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f42\">smooth ronquil</span></p></td><td class=\"cl-db0358c4\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f42\">species</span></p></td><td class=\"cl-db0358c3\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f42\">282556</span></p></td><td class=\"cl-db0358c3\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f42\">170954</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-db0358b9\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f42\">21308</span></p></td><td class=\"cl-db0358c2\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f42\">Thyriscus anoplus</span></p></td><td class=\"cl-db0358c2\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f42\">sponge sculpin</span></p></td><td class=\"cl-db0358c2\"><p class=\"cl-db0326b8\"><span class=\"cl-dafd7f42\">species</span></p></td><td class=\"cl-db0358b9\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f42\">282971</span></p></td><td class=\"cl-db0358b9\"><p class=\"cl-db0326a4\"><span class=\"cl-dafd7f42\">167367</span></p></td></tr></tbody></table></div>\n```\n\n:::\n\n```{.r .cell-code}\n# save outputs for later comparison\ndat_species_api <- dat\n```\n:::\n\n\n## Ex. Create zero-filled data using data loaded in last example\n\nIt is important to create and have access to zero-fill (presence and absence) so you can do simple analyses and plot data. \n\nFirst prepare a table with all combinations of what species should be listed for what hauls/surveys. For zero-filled data, all species caught in a survey need to have zero or non-zero row entries for a haul\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomb <- dplyr::full_join(\n  # find all species that have been caught, by survey\n  x = dplyr::left_join(dat_catch_api, dat_haul_api, by = \"hauljoin\") %>%\n    dplyr::select(survey_definition_id, species_code) %>%\n    dplyr::distinct(),\n  # find all haul events (hauljoins), by survey\n  y = dat_haul_api %>%\n    dplyr::select(survey_definition_id, hauljoin) %>%\n    dplyr::distinct(),\n  relationship = \"many-to-many\",\n  by = \"survey_definition_id\"\n) %>% \n  dplyr::select(-survey_definition_id) # now, redundant\n```\n:::\n\n\nExplore the data contents:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(paste0(\"rows: \", nrow(comb), \"; cols: \", ncol(comb)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 21802167; cols: 2\"\n```\n\n\n:::\n\n```{.r .cell-code}\ncomb %>% head(3) %>% \n  flextable::flextable()  %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"species_code\", \"hauljoin\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-dc5baec2{}.cl-dc4c4ac2{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-dc4c4acc{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-dc526c9a{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-dc52a142{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc52a160{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc52a16a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-dc5baec2'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-dc52a142\"><p class=\"cl-dc526c9a\"><span class=\"cl-dc4c4ac2\">species_code</span></p></th><th class=\"cl-dc52a142\"><p class=\"cl-dc526c9a\"><span class=\"cl-dc4c4ac2\">hauljoin</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-dc52a160\"><p class=\"cl-dc526c9a\"><span class=\"cl-dc4c4acc\">69086</span></p></td><td class=\"cl-dc52a160\"><p class=\"cl-dc526c9a\"><span class=\"cl-dc4c4acc\">-7112</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-dc52a16a\"><p class=\"cl-dc526c9a\"><span class=\"cl-dc4c4acc\">69086</span></p></td><td class=\"cl-dc52a16a\"><p class=\"cl-dc526c9a\"><span class=\"cl-dc4c4acc\">-7113</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-dc52a160\"><p class=\"cl-dc526c9a\"><span class=\"cl-dc4c4acc\">69086</span></p></td><td class=\"cl-dc52a160\"><p class=\"cl-dc526c9a\"><span class=\"cl-dc4c4acc\">-7115</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nNow, using that table of combinations (here, called `comb`), join data to make a full zero-filled CPUE dataset. When all of the data have been full joined together, there should be the maximum number of rows in `comb`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- comb %>%\n  # add species data\n  dplyr::left_join(dat_species_api) %>% # , \"species_code\"\n  # add haul data\n  dplyr::left_join(dat_haul_api) %>% # , c(\"hauljoin\")\n  # add catch data\n  dplyr::left_join(dat_catch_api) %>% # , c(\"species_code\", \"hauljoin\")\n  # modify/clean up zero-filled rows\n  dplyr::mutate(\n    cpue_kgkm2 = ifelse(is.na(cpue_kgkm2), 0, cpue_kgkm2),\n    cpue_nokm2 = ifelse(is.na(cpue_nokm2), 0, cpue_nokm2),\n    count = ifelse(is.na(count), 0, count),\n    weight_kg = ifelse(is.na(weight_kg), 0, weight_kg))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nTRUE Joining with `by = join_by(species_code)`\nTRUE Joining with `by = join_by(hauljoin)`\nTRUE Joining with `by = join_by(species_code, hauljoin)`\n```\n\n\n:::\n:::\n\n\nExplore the data contents:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find how many rows and columns are in the data pull\nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 21802167; cols: 38\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# learn about the structure of the data\nsummary(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  species_code      hauljoin       scientific_name    common_name       \n Min.   :    1   Min.   : -23911   Length:21802167    Length:21802167   \n 1st Qu.:21815   1st Qu.: -14005   Class :character   Class :character  \n Median :68000   Median :  -4364   Mode  :character   Mode  :character  \n Mean   :50613   Mean   : 298144                                        \n 3rd Qu.:75021   3rd Qu.: 821813                                        \n Max.   :99999   Max.   :1225635                                        \n                                                                        \n   id_rank              worms              itis              year     \n Length:21802167    Min.   :     51   Min.   :  46861   Min.   :1982  \n Class :character   1st Qu.: 126995   1st Qu.:  97687   1st Qu.:1997  \n Mode  :character   Median : 254512   Median : 160846   Median :2006  \n                    Mean   : 265801   Mean   : 203926   Mean   :2006  \n                    3rd Qu.: 292719   3rd Qu.: 167452   3rd Qu.:2015  \n                    Max.   :1699283   Max.   :1206057   Max.   :2024  \n                    NA's   :1950005   NA's   :2635604                 \n     srvy              survey          survey_name        survey_definition_id\n Length:21802167    Length:21802167    Length:21802167    Min.   : 47.00      \n Class :character   Class :character   Class :character   1st Qu.: 47.00      \n Mode  :character   Mode  :character   Mode  :character   Median : 52.00      \n                                                          Mean   : 69.02      \n                                                          3rd Qu.: 98.00      \n                                                          Max.   :143.00      \n                                                                              \n     cruise         cruisejoin           haul          stratum   \n Min.   :198201   Min.   :   -770   Min.   :  1.0   Min.   : 10  \n 1st Qu.:199701   1st Qu.:   -697   1st Qu.: 59.0   1st Qu.: 31  \n Median :200601   Median :   -616   Median :117.0   Median : 61  \n Mean   :200556   Mean   : 302940   Mean   :122.6   Mean   :142  \n 3rd Qu.:201501   3rd Qu.: 837800   3rd Qu.:177.0   3rd Qu.:212  \n Max.   :202401   Max.   :1225395   Max.   :355.0   Max.   :794  \n                                                                 \n   station            vessel_id   vessel_name         date_time        \n Length:21802167    Min.   :  1   Length:21802167    Length:21802167   \n Class :character   1st Qu.: 88   Class :character   Class :character  \n Mode  :character   Median : 94   Mode  :character   Mode  :character  \n                    Mean   :110                                        \n                    3rd Qu.:147                                        \n                    Max.   :178                                        \n                                                                       \n latitude_dd_start longitude_dd_start latitude_dd_end longitude_dd_end\n Min.   :51.19     Min.   :-180.0     Min.   :51.19   Min.   :-180.0  \n 1st Qu.:54.68     1st Qu.:-169.9     1st Qu.:54.68   1st Qu.:-169.9  \n Median :56.98     Median :-163.4     Median :56.98   Median :-163.4  \n Mean   :56.61     Mean   :-136.6     Mean   :56.61   Mean   :-136.6  \n 3rd Qu.:58.67     3rd Qu.:-152.1     3rd Qu.:58.67   3rd Qu.:-152.1  \n Max.   :65.34     Max.   : 180.0     Max.   :65.35   Max.   : 180.0  \n                                      NA's   :2279    NA's   :2279    \n bottom_temperature_c surface_temperature_c    depth_m     distance_fished_km\n Min.   :-2.1         Min.   :-1.1          Min.   :   9   Min.   :0.135     \n 1st Qu.: 3.1         1st Qu.: 5.9          1st Qu.:  71   1st Qu.:1.481     \n Median : 4.3         Median : 7.6          Median : 109   Median :1.681     \n Mean   : 4.1         Mean   : 8.0          Mean   : 142   Mean   :2.097     \n 3rd Qu.: 5.4         3rd Qu.: 9.7          3rd Qu.: 167   3rd Qu.:2.801     \n Max.   :15.3         Max.   :18.1          Max.   :1200   Max.   :4.334     \n NA's   :1108488      NA's   :599913                                         \n  duration_hr      net_width_m     net_height_m     area_swept_km2    \n Min.   :0.0250   Min.   : 7.51   Min.   : 0.0      Min.   :0.002314  \n 1st Qu.:0.2690   1st Qu.:15.54   1st Qu.: 2.6      1st Qu.:0.023805  \n Median :0.3060   Median :16.33   Median : 6.2      Median :0.027887  \n Mean   :0.3801   Mean   :16.36   Mean   : 5.2      Mean   :0.034451  \n 3rd Qu.:0.5000   3rd Qu.:17.12   3rd Qu.: 6.9      3rd Qu.:0.046306  \n Max.   :0.9800   Max.   :23.82   Max.   :11.0      Max.   :0.077795  \n                                  NA's   :1746006                     \n  performance       cpue_kgkm2        cpue_nokm2           count         \n Min.   :0.0000   Min.   :      0   Min.   :       0   Min.   :     0.0  \n 1st Qu.:0.0000   1st Qu.:      0   1st Qu.:       0   1st Qu.:     0.0  \n Median :0.0000   Median :      0   Median :       0   Median :     0.0  \n Mean   :0.2924   Mean   :     51   Mean   :     170   Mean   :     6.7  \n 3rd Qu.:0.0000   3rd Qu.:      0   3rd Qu.:       0   3rd Qu.:     0.0  \n Max.   :7.0000   Max.   :3226235   Max.   :21780780   Max.   :867119.0  \n                                                                         \n   weight_kg         taxon_confidence  \n Min.   :    0.000   Length:21802167   \n 1st Qu.:    0.000   Class :character  \n Median :    0.000   Mode  :character  \n Mean   :    1.708                     \n 3rd Qu.:    0.000                     \n Max.   :18187.700                     \n                                       \n```\n\n\n:::\n\n```{.r .cell-code}\n# Print the first few lines of the data \ndat %>% \n  head(3) %>% \n  flextable::flextable() %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"species_code\", \"worms\", \"itis\", \"hauljoin\", \"year\", \"cruise\", \"cruisejoin\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-02f0200e{}.cl-02dac902{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-02dac916{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-02e240d8{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-02e240ec{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-02e28048{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02e28052{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02e28053{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02e2805c{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02e28066{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02e28070{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-02f0200e'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">species_code</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">hauljoin</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">scientific_name</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">common_name</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">id_rank</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">worms</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">itis</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">year</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">srvy</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">survey</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">survey_name</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">survey_definition_id</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">cruise</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">cruisejoin</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">haul</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">stratum</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">station</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">vessel_id</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">vessel_name</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">date_time</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">latitude_dd_start</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">longitude_dd_start</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">latitude_dd_end</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">longitude_dd_end</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">bottom_temperature_c</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">surface_temperature_c</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">depth_m</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">distance_fished_km</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">duration_hr</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">net_width_m</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">net_height_m</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">area_swept_km2</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">performance</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">cpue_kgkm2</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">cpue_nokm2</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">count</span></p></th><th class=\"cl-02e28048\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac902\">weight_kg</span></p></th><th class=\"cl-02e28052\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac902\">taxon_confidence</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">69086</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-7112</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">Pagurus trigonocheirus</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">fuzzy hermit crab</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">species</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">254490</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">97796</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2010</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">NBS</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">northern Bering Sea</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">Northern Bering Sea Crab/Groundfish Survey - Eastern Bering Sea Shelf Survey Extension</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">143</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">201002</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-662</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">40</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">71</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">EE-18</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">94</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">VESTERAALEN</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">2010-08-01T15:40:43Z</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">65.02415</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-169.1029</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">65.00695</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-169.1481</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2.3</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">3.2</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">48</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2.866</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">0.536</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">16.717</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2.088</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">0.047911</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">5.2</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">226.3784</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">4,424.878</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">212</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">10.846</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">High</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">69086</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-7113</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">Pagurus trigonocheirus</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">fuzzy hermit crab</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">species</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">254490</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">97796</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2010</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">NBS</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">northern Bering Sea</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">Northern Bering Sea Crab/Groundfish Survey - Eastern Bering Sea Shelf Survey Extension</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">143</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">201002</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-662</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">41</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">71</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">EE-19</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">94</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">VESTERAALEN</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">2010-08-01T18:26:46Z</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">65.01542</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-169.8899</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">64.99855</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-169.9398</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2.0</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">4.9</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">49</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">3.010</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">0.540</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">16.372</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2.048</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">0.049280</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">5.2</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">699.5575</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">12,905.917</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">636</span></p></td><td class=\"cl-02e28066\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">34.474</span></p></td><td class=\"cl-02e28070\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">High</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">69086</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-7115</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">Pagurus trigonocheirus</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">fuzzy hermit crab</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">species</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">254490</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">97796</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2010</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">NBS</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">northern Bering Sea</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">Northern Bering Sea Crab/Groundfish Survey - Eastern Bering Sea Shelf Survey Extension</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">143</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">201002</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-662</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">43</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">71</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">FF-01</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">94</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">VESTERAALEN</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">2010-08-02T10:10:05Z</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">65.32702</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-168.4268</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">65.34040</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">-168.4225</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2.0</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">8.9</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">53</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">1.501</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">0.284</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">17.560</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">2.748</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">0.026358</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">1.1</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">682.8022</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">10,054.041</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">265</span></p></td><td class=\"cl-02e28053\"><p class=\"cl-02e240d8\"><span class=\"cl-02dac916\">17.997</span></p></td><td class=\"cl-02e2805c\"><p class=\"cl-02e240ec\"><span class=\"cl-02dac916\">High</span></p></td></tr></tbody></table></div>\n```\n\n:::\n\n```{.r .cell-code}\n# save outputs for later comparison\ndat_zerofill_api <- dat\n```\n:::\n\n\n## Ex. Visualize zero-filled data for 2023 eastern Bering Sea walleye pollock in CPUE data in distribution map\n\nUsing the zero-filled data from the previous example, we can make a few plots! \n\nHere is some example data of 2023 through 2019 (`year %in% 2019:2023`) eastern and northern Bering Sea (`srvy %in% c(\"EBS\", \"NBS)`) walleye pollock (`species_code == 21740`). \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- dat_zerofill_api %>% \n  dplyr::filter(year %in% 2019:2023 & \n                  srvy %in% c(\"EBS\", \"NBS\") & \n                  species_code == 21740) %>% \n  dplyr::select(year, common_name, longitude_dd_start, latitude_dd_start, cpue_kgkm2)\n\n# Find how many rows and columns are in the data pull\nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 2052; cols: 5\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# # learn about the structure of the data\n# summary(dat)\n\n# Print the first few lines of the data \ndat %>% \n  head(3) %>% \n  flextable::flextable() %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"year\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-03e65064{}.cl-03d6f5d8{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-03d6f5ec{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-03dcdfb6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-03dcdfca{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-03dd1468{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-03dd1472{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-03dd147c{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-03dd147d{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-03dd1486{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-03dd1490{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-03e65064'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-03dd1468\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5d8\">year</span></p></th><th class=\"cl-03dd1472\"><p class=\"cl-03dcdfca\"><span class=\"cl-03d6f5d8\">common_name</span></p></th><th class=\"cl-03dd1468\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5d8\">longitude_dd_start</span></p></th><th class=\"cl-03dd1468\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5d8\">latitude_dd_start</span></p></th><th class=\"cl-03dd1468\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5d8\">cpue_kgkm2</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-03dd147c\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">2022</span></p></td><td class=\"cl-03dd147d\"><p class=\"cl-03dcdfca\"><span class=\"cl-03d6f5ec\">walleye pollock</span></p></td><td class=\"cl-03dd147c\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">-161.5309</span></p></td><td class=\"cl-03dd147c\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">64.01371</span></p></td><td class=\"cl-03dd147c\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">0.000000</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-03dd1486\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">2022</span></p></td><td class=\"cl-03dd1490\"><p class=\"cl-03dcdfca\"><span class=\"cl-03d6f5ec\">walleye pollock</span></p></td><td class=\"cl-03dd1486\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">-162.2692</span></p></td><td class=\"cl-03dd1486\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">64.00619</span></p></td><td class=\"cl-03dd1486\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">0.000000</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-03dd147c\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">2022</span></p></td><td class=\"cl-03dd147d\"><p class=\"cl-03dcdfca\"><span class=\"cl-03d6f5ec\">walleye pollock</span></p></td><td class=\"cl-03dd147c\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">-163.0456</span></p></td><td class=\"cl-03dd147c\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">63.97936</span></p></td><td class=\"cl-03dd147c\"><p class=\"cl-03dcdfb6\"><span class=\"cl-03d6f5ec\">0.868724</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n### Plot locations on map\n\n\n::: {.cell tbl-cap='CPUE (kg/km^2) of walleye pollock catch at each station in the 2019-2023 eastern and northern Bering Sea bottom trawl surveys. Size of black circles denote magnitude of CPUE caught at station and red triangles denote stations where walleye pollock were not caught. '}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot2::ggplot(data = dat %>% dplyr::filter(cpue_kgkm2 != 0), \n                mapping = aes(x = longitude_dd_start, \n                              y = latitude_dd_start, \n                              size = cpue_kgkm2)) + \n  ggplot2::geom_point(alpha = .75) +\n  ggplot2::geom_point(data = dat %>% dplyr::filter(cpue_kgkm2 == 0), \n                      color = \"red\", \n                      shape = 17,\n                      alpha = .75,\n                      size = 3) +\n  ggplot2::xlab(\"Longitude *W\") +\n  ggplot2::ylab(\"Latitude *N\") +\n  ggplot2::ggtitle(label = \"CPUE (kg/km^2) of walleye pollock (Weight CPUE; kg/km2)\", \n                   subtitle = \"Eastern Bering Sea bottom trawl survey\") +\n  ggplot2::scale_size_continuous(name = \"Weight (kg)\") + \n  ggplot2::facet_wrap(facets = vars(year)) + \n  ggplot2::theme_bw()\n```\n\n::: {.cell-output-display}\n![](foss-api-r_files/figure-html/pollock-multi-loc-1.png){width=672}\n:::\n:::\n\n\n### Plot inverse-distance weighted plot of CPUE\n\nThis map is constructed using [`akgfmaps`](https://github.com/afsc-gap-products/akgfmaps). To make IDW plots, you must have data from all stations surveyed, even if no fish of interest were found there. \n\nThese plots are similar to those published in the [annual Bering Sea data reports](https://www.fisheries.noaa.gov/alaska/science-data/groundfish-assessment-program-bottom-trawl-surveys#communications). \n\n\n::: {.cell tbl-cap='Inverse-distance weight CPUE of walleye pollock catch at each station in the 2019-2023 eastern and northern Bering Sea bottom trawl surveys. '}\n\n```{.r .cell-code}\n# devtools::install_github(\"afsc-gap-products/akgfmaps\", build_vignettes = TRUE)\nlibrary(akgfmaps)\nidw <- akgfmaps::make_idw_stack(\n  x = dat %>% \n    dplyr::select(COMMON_NAME = common_name, \n                  CPUE_KGHA = cpue_kgkm2, \n                  LATITUDE = latitude_dd_start, \n                  LONGITUDE = longitude_dd_start, \n                  year), \n  grouping.vars = \"year\", \n  region = \"bs.all\", # Predefined EBS area\n  set.breaks = \"jenks\", # Gets Jenks breaks from classint::classIntervals()\n  in.crs = \"+proj=longlat\", # Set input coordinate reference system\n  out.crs = \"EPSG:3338\", # Set output coordinate reference system\n  extrapolation.grid.type = \"sf\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[inverse distance weighted interpolation]\n[inverse distance weighted interpolation]\n[inverse distance weighted interpolation]\n[inverse distance weighted interpolation]\n[inverse distance weighted interpolation]\n[inverse distance weighted interpolation]\n[inverse distance weighted interpolation]\n[inverse distance weighted interpolation]\n```\n\n\n:::\n\n```{.r .cell-code}\nshps <- akgfmaps::get_base_layers(\n  select.region = \"bs.all\", \n  include.corners = TRUE, \n  set.crs = \"EPSG:3338\")\n\n# set.breaks <- akgfmaps::eval_plot_breaks(CPUE = dat$cpue_kgkm2, n.breaks = 5)\n# set.breaks <- as.vector(unlist(set.breaks[set.breaks$style == \"pretty\", -1]))\nset.breaks <- c(0, 50000, 100000, 150000, 200000, 250000)\n\nfigure_print <- ggplot() +\n  # add map of alaska\n  ggplot2::geom_sf(data = shps$akland,\n                   color = NA,\n                   fill = \"grey50\") +\n  # add IDW plots\n  geom_sf(data = idw$extrapolation.stack,\n          mapping = aes(fill = var1.pred),\n          na.rm = FALSE,\n          show.legend = TRUE, \n          color = NA) +\n  ggplot2::scale_fill_manual(\n    name = \"walleye pollock\\nCPUE (kg/km2)\",\n    values =  c(\"gray90\",\n                viridis::viridis(\n                  option = \"mako\",\n                  direction = -1,\n                  n = length(set.breaks)-1,\n                  begin = 0.20,\n                  end = 0.80)),\n    na.translate = FALSE, # Don't use NA\n    drop = FALSE) + \n  # seperate plots by year\n  ggplot2::facet_wrap(facets = vars(year), nrow = 2) + \n  # add survey area\n  ggplot2::geom_sf(\n    data = shps$survey.area, \n    mapping = aes(color = SURVEY, \n                  geometry = geometry), \n    fill = \"transparent\", \n    linewidth = 1, \n    show.legend = FALSE) +\n  ggplot2::scale_color_manual(\n    name = \" \", \n    values = c(\"grey30\", \"grey50\"),\n    breaks = shps$survey.area$SURVEY,\n    labels = shps$survey.area$SRVY) + \n  # lat/lon axis and map bounds\n  ggplot2::scale_x_continuous(name = \"Longitude °W\",\n                              breaks = seq(-180, -150, 5)) +\n  ggplot2::scale_y_continuous(name = \"Latitude °N\",\n                              breaks = seq(50, 65, 5)) + # seq(52, 62, 2)\n  ggplot2::coord_sf(xlim = sf::st_bbox(shps$survey.area)[c(1,3)],\n                    ylim = sf::st_bbox(shps$survey.area)[c(2,4)]) +\n  # add theme aesthetics\n  ggplot2::guides(\n    fill = guide_legend(\n      order = 1,\n      title.position = \"top\",\n      label.position = \"bottom\",\n      title.hjust = 0.5,\n      override.aes = list(color = NA),\n      nrow = 1),\n    color = \"none\") +\n  ggplot2::theme( \n    panel.background = element_rect(fill = \"white\", colour = NA), \n    panel.border = element_rect(fill = NA, colour = \"grey20\"), \n    strip.background = element_blank(), \n    strip.text = element_text(size = 10, face = \"bold\"), \n    legend.text = element_text(size = 9),\n    legend.background = element_rect(colour = \"transparent\", \n                                     fill = \"transparent\"),\n    legend.key = element_rect(colour = \"transparent\", \n                              fill = \"transparent\"),\n    legend.position = \"bottom\", \n    legend.box = \"horizontal\",\n    legend.box.spacing = unit(0, \"pt\"), # reduce space between legend & plot\n    legend.margin=margin(0, 0, 0, 0) )\n\nfigure_print\n```\n\n::: {.cell-output-display}\n![](foss-api-r_files/figure-html/pollock-multi-idw-1.png){width=576}\n:::\n:::\n\n\n## Ex. Show catch data for 2023 eastern Bering Sea Walleye Pollock (one species in one survey region in one year)\n\nData downloads and joins for just one species, survey, and year are much faster and easier to do. \n\nFirst, because `year` is identified in the haul table, we need to identify all of the hauls (or more specifically, `hauljoin` codes) that were completed in the eastern Bering Sea (`\"srvy\":\"EBS\"`) in 2023 (`\"year\":2023`). \n\nNote: Check how many rows and columns are in the data pull. The eastern Bering Sea survey (before 2024) has 376 stations in it, and pollock are often found in throughout the region so this should have a similar number of rows. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## query the API link\nres <- httr::GET(url = paste0(api_link_haul, '?limit=10000&q={\"year\":2023,\"srvy\":\"EBS\"}'))\n\n## convert from JSON format\ndata <- jsonlite::fromJSON(base::rawToChar(res$content)) \ndat <- data$items %>%\n  dplyr::select(-links) # necessary for API accounting, but not part of the dataset\n\n## show summary of data to make sure it is subset correctly\nsummary(dat %>% dplyr::mutate(srvy = as.factor(srvy)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      year       srvy        survey          survey_name       \n Min.   :2023   EBS:376   Length:376         Length:376        \n 1st Qu.:2023             Class :character   Class :character  \n Median :2023             Mode  :character   Mode  :character  \n Mean   :2023                                                  \n 3rd Qu.:2023                                                  \n Max.   :2023                                                  \n survey_definition_id     cruise         cruisejoin        hauljoin     \n Min.   :98           Min.   :202301   Min.   :-760.0   Min.   :-23019  \n 1st Qu.:98           1st Qu.:202301   1st Qu.:-760.0   1st Qu.:-22776  \n Median :98           Median :202301   Median :-759.0   Median :-22539  \n Mean   :98           Mean   :202301   Mean   :-759.5   Mean   :-22552  \n 3rd Qu.:98           3rd Qu.:202301   3rd Qu.:-759.0   3rd Qu.:-22333  \n Max.   :98           Max.   :202301   Max.   :-759.0   Max.   :-22110  \n      haul           stratum        station            vessel_id    \n Min.   :  7.00   Min.   :10.00   Length:376         Min.   :134.0  \n 1st Qu.: 65.75   1st Qu.:31.00   Class :character   1st Qu.:134.0  \n Median :114.00   Median :41.00   Mode  :character   Median :162.0  \n Mean   :114.16   Mean   :39.22                      Mean   :148.3  \n 3rd Qu.:161.25   3rd Qu.:50.00                      3rd Qu.:162.0  \n Max.   :224.00   Max.   :90.00                      Max.   :162.0  \n vessel_name         date_time         latitude_dd_start longitude_dd_start\n Length:376         Length:376         Min.   :54.66     Min.   :-178.2    \n Class :character   Class :character   1st Qu.:57.00     1st Qu.:-172.7    \n Mode  :character   Mode  :character   Median :58.02     Median :-168.9    \n                                       Mean   :58.26     Mean   :-168.8    \n                                       3rd Qu.:59.50     3rd Qu.:-165.2    \n                                       Max.   :62.01     Max.   :-158.3    \n latitude_dd_end longitude_dd_end bottom_temperature_c surface_temperature_c\n Min.   :54.68   Min.   :-178.2   Min.   :-1.600       Min.   : 1.700       \n 1st Qu.:57.01   1st Qu.:-172.7   1st Qu.: 1.200       1st Qu.: 4.200       \n Median :58.02   Median :-168.9   Median : 2.700       Median : 6.550       \n Mean   :58.26   Mean   :-168.8   Mean   : 2.249       Mean   : 6.386       \n 3rd Qu.:59.50   3rd Qu.:-165.2   3rd Qu.: 3.500       3rd Qu.: 8.525       \n Max.   :62.01   Max.   :-158.3   Max.   : 5.400       Max.   :11.000       \n    depth_m       distance_fished_km  duration_hr      net_width_m   \n Min.   : 20.00   Min.   :1.065      Min.   :0.1890   Min.   :12.90  \n 1st Qu.: 54.75   1st Qu.:2.805      1st Qu.:0.5100   1st Qu.:16.66  \n Median : 74.00   Median :2.889      Median :0.5180   Median :17.27  \n Mean   : 80.75   Mean   :2.854      Mean   :0.5129   Mean   :17.15  \n 3rd Qu.:105.00   3rd Qu.:2.945      3rd Qu.:0.5260   3rd Qu.:17.83  \n Max.   :171.00   Max.   :3.849      Max.   :0.6560   Max.   :20.29  \n  net_height_m   area_swept_km2     performance    \n Min.   :1.300   Min.   :0.02017   Min.   :0.0000  \n 1st Qu.:1.875   1st Qu.:0.04725   1st Qu.:0.0000  \n Median :2.064   Median :0.04944   Median :0.0000  \n Mean   :2.107   Mean   :0.04892   Mean   :0.1075  \n 3rd Qu.:2.343   3rd Qu.:0.05134   3rd Qu.:0.0000  \n Max.   :3.196   Max.   :0.06369   Max.   :6.2200  \n```\n\n\n:::\n\n```{.r .cell-code}\n## Find how many rows and columns are in the data pull. \nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 376; cols: 27\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# save outputs for later comparison\ndat_haul_ex <- dat\n```\n:::\n\n::: {.cell tbl-cap='Haul data filtered by `year = 2023` and `SRVY = \\'EBS\\'`. '}\n\n```{.r .cell-code}\n# Print the first few lines of the data \ndat_haul_ex %>% \n  head(3) %>% \n  flextable::flextable() %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"year\", \"hauljoin\", \"cruise\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-3445e724{}.cl-34348880{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-34348894{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-343b0f70{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-343b0f84{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-343b4968{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-343b4972{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-343b4986{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-343b4987{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-343b4990{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-343b499a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-3445e724'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">year</span></p></th><th class=\"cl-343b4972\"><p class=\"cl-343b0f84\"><span class=\"cl-34348880\">srvy</span></p></th><th class=\"cl-343b4972\"><p class=\"cl-343b0f84\"><span class=\"cl-34348880\">survey</span></p></th><th class=\"cl-343b4972\"><p class=\"cl-343b0f84\"><span class=\"cl-34348880\">survey_name</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">survey_definition_id</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">cruise</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">cruisejoin</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">hauljoin</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">haul</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">stratum</span></p></th><th class=\"cl-343b4972\"><p class=\"cl-343b0f84\"><span class=\"cl-34348880\">station</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">vessel_id</span></p></th><th class=\"cl-343b4972\"><p class=\"cl-343b0f84\"><span class=\"cl-34348880\">vessel_name</span></p></th><th class=\"cl-343b4972\"><p class=\"cl-343b0f84\"><span class=\"cl-34348880\">date_time</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">latitude_dd_start</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">longitude_dd_start</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">latitude_dd_end</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">longitude_dd_end</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">bottom_temperature_c</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">surface_temperature_c</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">depth_m</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">distance_fished_km</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">duration_hr</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">net_width_m</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">net_height_m</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">area_swept_km2</span></p></th><th class=\"cl-343b4968\"><p class=\"cl-343b0f70\"><span class=\"cl-34348880\">performance</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">2023</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">EBS</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">eastern Bering Sea</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">98</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">202301</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-759</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-22123</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">25</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">10</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">E-12</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">162</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">ALASKA KNIGHT</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">2023-05-28T15:56:41Z</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">56.33791</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-160.9950</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">56.33839</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-161.0420</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">4.0</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">4.2</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">54</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">2.917</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">0.522</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">16.079</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">1.983</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">0.046902</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">0</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">2023</span></p></td><td class=\"cl-343b499a\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">EBS</span></p></td><td class=\"cl-343b499a\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">eastern Bering Sea</span></p></td><td class=\"cl-343b499a\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">98</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">202301</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-759</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-22125</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">27</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">31</span></p></td><td class=\"cl-343b499a\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">F-13</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">162</span></p></td><td class=\"cl-343b499a\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">ALASKA KNIGHT</span></p></td><td class=\"cl-343b499a\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">2023-05-29T10:48:20Z</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">56.65813</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-160.3893</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">56.67233</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-160.3497</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">3.7</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">3.7</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">59</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">2.900</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">0.525</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">17.206</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">1.932</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">0.049897</span></p></td><td class=\"cl-343b4990\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">0</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">2023</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">EBS</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">eastern Bering Sea</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">98</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">202301</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-759</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-22126</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">28</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">10</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">F-14</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">162</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">ALASKA KNIGHT</span></p></td><td class=\"cl-343b4987\"><p class=\"cl-343b0f84\"><span class=\"cl-34348894\">2023-05-29T14:17:28Z</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">56.67258</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-159.7784</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">56.68401</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">-159.7380</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">4.6</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">4.7</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">37</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">2.790</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">0.511</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">15.529</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">2.355</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">0.043326</span></p></td><td class=\"cl-343b4986\"><p class=\"cl-343b0f70\"><span class=\"cl-34348894\">0</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n### Identify `species_code` for walleye pollock\n\nIn the catch data, we itemize species catches by `species_code`. To find out which `species_code` to use, you can check variations on the following code. Note that here the word `pollock` is case sensitive. All species `common_name` entries are lower case except for proper nouns (e.g., \"Pacific\"). The notation for finding a string is to use `%` around the phrase. Since `%` is a reserved character in a URL, you have to replace `%` with `%25`. Similarly, `%20` needs to be used in place of a space (e.g., between \"walleye\" and \"pollock\": `\"walleye%20pollock\"}'`).  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## query the API link. Use: \nres <- httr::GET(url = paste0(api_link_species, '?q={%22common_name%22:%22walleye%20pollock%22}'))\n# OR\nres <- httr::GET(url = paste0(api_link_species, '?q={\"common_name\":{\"$like\":\"%25pollock%25\"}}'))\n# OR\nres <- httr::GET(url = paste0(api_link_species, '?q={\"common_name\":\"walleye%20pollock\"}'))\n\n## convert from JSON format\ndata <- jsonlite::fromJSON(base::rawToChar(res$content)) \n\n# save outputs for later comparison\ndat_species_ex <- data$items %>% dplyr::select(-links) # necessary for API accounting, but not part of the dataset\n```\n:::\n\n::: {.cell tbl-cap='Walleye pollock species information. '}\n\n```{.r .cell-code}\n# Print the first few lines of the data\ndat_species_ex %>% \n  head(3) %>% \n  flextable::flextable() %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"species_code\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-3539bcd2{}.cl-3528c742{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-3528c756{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-352f13f4{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-352f1408{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-352f4f54{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-352f4f5e{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-352f4f68{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-352f4f72{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-3539bcd2'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-352f4f54\"><p class=\"cl-352f13f4\"><span class=\"cl-3528c742\">species_code</span></p></th><th class=\"cl-352f4f5e\"><p class=\"cl-352f1408\"><span class=\"cl-3528c742\">scientific_name</span></p></th><th class=\"cl-352f4f5e\"><p class=\"cl-352f1408\"><span class=\"cl-3528c742\">common_name</span></p></th><th class=\"cl-352f4f5e\"><p class=\"cl-352f1408\"><span class=\"cl-3528c742\">id_rank</span></p></th><th class=\"cl-352f4f54\"><p class=\"cl-352f13f4\"><span class=\"cl-3528c742\">worms</span></p></th><th class=\"cl-352f4f54\"><p class=\"cl-352f13f4\"><span class=\"cl-3528c742\">itis</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-352f4f68\"><p class=\"cl-352f13f4\"><span class=\"cl-3528c756\">21740</span></p></td><td class=\"cl-352f4f72\"><p class=\"cl-352f1408\"><span class=\"cl-3528c756\">Gadus chalcogrammus</span></p></td><td class=\"cl-352f4f72\"><p class=\"cl-352f1408\"><span class=\"cl-3528c756\">walleye pollock</span></p></td><td class=\"cl-352f4f72\"><p class=\"cl-352f1408\"><span class=\"cl-3528c756\">species</span></p></td><td class=\"cl-352f4f68\"><p class=\"cl-352f13f4\"><span class=\"cl-3528c756\">300,735</span></p></td><td class=\"cl-352f4f68\"><p class=\"cl-352f13f4\"><span class=\"cl-3528c756\">934,083</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n### Then, apply the `hauljoins` and `species_code` to catch query\n\nWe'll use the data from the haul and species table we collected before to select 2023 eastern Bering Sea walleye pollock catch data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## query the API link\n# data for all walleye pollock caught in all 2023 eastern Bering Sea survey hauls\ndat <- data.frame()\n# there must be a better way to select multiple values for one parameter, \n# but saving that, we will loop through each hauljoin and collect the data of interest\nfor (i in 1:nrow(dat_haul_ex)) {\n  res <- httr::GET(url = paste0(\n    api_link_catch, \n    '?q={\"species_code\":21740,\"hauljoin\":', dat_haul_ex$hauljoin[i],'}'))\n  ## convert from JSON format\n  data <- jsonlite::fromJSON(base::rawToChar(res$content)) \n  if (length(data$items) != 0) {\n    dat <- dplyr::bind_rows(\n      dat,\n      data$items %>% \n        dplyr::select(-links)) # necessary for API accounting, but not part of the dataset\n  }\n}\n```\n:::\n\n\nExplore data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find how many rows and columns are in the data pull\nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 374; cols: 7\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# learn about the structure of the data\nsummary(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    hauljoin       species_code     cpue_kgkm2          cpue_nokm2       \n Min.   :-23019   Min.   :21740   Min.   :    10.34   Min.   :    18.26  \n 1st Qu.:-22777   1st Qu.:21740   1st Qu.:  1454.44   1st Qu.:  2278.72  \n Median :-22540   Median :21740   Median :  3286.76   Median :  5875.33  \n Mean   :-22553   Mean   :21740   Mean   :  6364.85   Mean   : 11565.45  \n 3rd Qu.:-22324   3rd Qu.:21740   3rd Qu.:  6956.25   3rd Qu.: 12512.98  \n Max.   :-22110   Max.   :21740   Max.   :148679.68   Max.   :202321.08  \n                                                      NA's   :1          \n     count        weight_kg        taxon_confidence  \n Min.   :   1   Min.   :   0.492   Length:374        \n 1st Qu.: 114   1st Qu.:  71.560   Class :character  \n Median : 286   Median : 162.310   Mode  :character  \n Mean   : 574   Mean   : 315.419                     \n 3rd Qu.: 619   3rd Qu.: 350.399                     \n Max.   :9997   Max.   :7346.495                     \n NA's   :1                                           \n```\n\n\n:::\n\n```{.r .cell-code}\n# Print the first few lines of the data \ndat %>% \n  head(3) %>% \n  flextable::flextable() %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"hauljoin\", \"species_code\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-656fc8ba{}.cl-655f6268{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-655f627c{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-656575b8{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-656575cc{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6565abf0{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6565abfa{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6565ac04{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6565ac0e{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6565ac0f{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6565ac18{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-656fc8ba'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-6565abf0\"><p class=\"cl-656575b8\"><span class=\"cl-655f6268\">hauljoin</span></p></th><th class=\"cl-6565abf0\"><p class=\"cl-656575b8\"><span class=\"cl-655f6268\">species_code</span></p></th><th class=\"cl-6565abf0\"><p class=\"cl-656575b8\"><span class=\"cl-655f6268\">cpue_kgkm2</span></p></th><th class=\"cl-6565abf0\"><p class=\"cl-656575b8\"><span class=\"cl-655f6268\">cpue_nokm2</span></p></th><th class=\"cl-6565abf0\"><p class=\"cl-656575b8\"><span class=\"cl-655f6268\">count</span></p></th><th class=\"cl-6565abf0\"><p class=\"cl-656575b8\"><span class=\"cl-655f6268\">weight_kg</span></p></th><th class=\"cl-6565abfa\"><p class=\"cl-656575cc\"><span class=\"cl-655f6268\">taxon_confidence</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">-22123</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">21740</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">3,969.8145</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">4,413.416</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">207</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">186.194</span></p></td><td class=\"cl-6565ac0e\"><p class=\"cl-656575cc\"><span class=\"cl-655f627c\">High</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6565ac0f\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">-22125</span></p></td><td class=\"cl-6565ac0f\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">21740</span></p></td><td class=\"cl-6565ac0f\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">3,872.0254</span></p></td><td class=\"cl-6565ac0f\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">8,477.396</span></p></td><td class=\"cl-6565ac0f\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">423</span></p></td><td class=\"cl-6565ac0f\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">193.204</span></p></td><td class=\"cl-6565ac18\"><p class=\"cl-656575cc\"><span class=\"cl-655f627c\">High</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">-22126</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">21740</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">172.2526</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">553.941</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">24</span></p></td><td class=\"cl-6565ac04\"><p class=\"cl-656575b8\"><span class=\"cl-655f627c\">7.463</span></p></td><td class=\"cl-6565ac0e\"><p class=\"cl-656575cc\"><span class=\"cl-655f627c\">High</span></p></td></tr></tbody></table></div>\n```\n\n:::\n\n```{.r .cell-code}\n# save outputs for later comparison\ndat_catch_ex <- dat\n```\n:::\n\n\nFor reference and to help break down the above query, see these other query examples:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data for haul -22775 (i.e., one specific haul)?\nres <- httr::GET(url = paste0(api_link_catch, \n                              '?offset=',i,'&limit=10000&q={\"hauljoin\":-22775}'))\n\n# data for all walleye pollock (i.e., one species) caught in all years and surveys\nres <- httr::GET(url = paste0(api_link_catch, \n                              '?offset=',i,'&limit=10000&q={\"species_code\":21740}'))\n```\n:::\n\n\n\n\n\n\n### Create zero-filled data for 2023 eastern Bering Sea walleye pollock and plot\n\nIt is important to create and have access to zero-fill (presence and absence) so you can do simple analyses and plot data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- dplyr::full_join(\n  dat_haul_ex,\n  dat_catch_ex) %>% \n  dplyr::full_join(\n    dat_species_ex)  %>% \n  # modify zero-filled rows\n  dplyr::mutate(\n    cpue_kgkm2 = ifelse(is.na(cpue_kgkm2), 0, cpue_kgkm2),\n    cpue_nokm2 = ifelse(is.na(cpue_nokm2), 0, cpue_nokm2),\n    count = ifelse(is.na(count), 0, count),\n    weight_kg = ifelse(is.na(weight_kg), 0, weight_kg))\n```\n:::\n\n\nExplore data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find how many rows and columns are in the data pull\nprint(paste0(\"rows: \", nrow(dat), \"; cols: \", ncol(dat)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"rows: 376; cols: 38\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# learn about the structure of the data\nsummary(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      year          srvy              survey          survey_name       \n Min.   :2023   Length:376         Length:376         Length:376        \n 1st Qu.:2023   Class :character   Class :character   Class :character  \n Median :2023   Mode  :character   Mode  :character   Mode  :character  \n Mean   :2023                                                           \n 3rd Qu.:2023                                                           \n Max.   :2023                                                           \n                                                                        \n survey_definition_id     cruise         cruisejoin        hauljoin     \n Min.   :98           Min.   :202301   Min.   :-760.0   Min.   :-23019  \n 1st Qu.:98           1st Qu.:202301   1st Qu.:-760.0   1st Qu.:-22776  \n Median :98           Median :202301   Median :-759.0   Median :-22539  \n Mean   :98           Mean   :202301   Mean   :-759.5   Mean   :-22552  \n 3rd Qu.:98           3rd Qu.:202301   3rd Qu.:-759.0   3rd Qu.:-22333  \n Max.   :98           Max.   :202301   Max.   :-759.0   Max.   :-22110  \n                                                                        \n      haul           stratum        station            vessel_id    \n Min.   :  7.00   Min.   :10.00   Length:376         Min.   :134.0  \n 1st Qu.: 65.75   1st Qu.:31.00   Class :character   1st Qu.:134.0  \n Median :114.00   Median :41.00   Mode  :character   Median :162.0  \n Mean   :114.16   Mean   :39.22                      Mean   :148.3  \n 3rd Qu.:161.25   3rd Qu.:50.00                      3rd Qu.:162.0  \n Max.   :224.00   Max.   :90.00                      Max.   :162.0  \n                                                                    \n vessel_name         date_time         latitude_dd_start longitude_dd_start\n Length:376         Length:376         Min.   :54.66     Min.   :-178.2    \n Class :character   Class :character   1st Qu.:57.00     1st Qu.:-172.7    \n Mode  :character   Mode  :character   Median :58.02     Median :-168.9    \n                                       Mean   :58.26     Mean   :-168.8    \n                                       3rd Qu.:59.50     3rd Qu.:-165.2    \n                                       Max.   :62.01     Max.   :-158.3    \n                                                                           \n latitude_dd_end longitude_dd_end bottom_temperature_c surface_temperature_c\n Min.   :54.68   Min.   :-178.2   Min.   :-1.600       Min.   : 1.700       \n 1st Qu.:57.01   1st Qu.:-172.7   1st Qu.: 1.200       1st Qu.: 4.200       \n Median :58.02   Median :-168.9   Median : 2.700       Median : 6.550       \n Mean   :58.26   Mean   :-168.8   Mean   : 2.249       Mean   : 6.386       \n 3rd Qu.:59.50   3rd Qu.:-165.2   3rd Qu.: 3.500       3rd Qu.: 8.525       \n Max.   :62.01   Max.   :-158.3   Max.   : 5.400       Max.   :11.000       \n                                                                            \n    depth_m       distance_fished_km  duration_hr      net_width_m   \n Min.   : 20.00   Min.   :1.065      Min.   :0.1890   Min.   :12.90  \n 1st Qu.: 54.75   1st Qu.:2.805      1st Qu.:0.5100   1st Qu.:16.66  \n Median : 74.00   Median :2.889      Median :0.5180   Median :17.27  \n Mean   : 80.75   Mean   :2.854      Mean   :0.5129   Mean   :17.15  \n 3rd Qu.:105.00   3rd Qu.:2.945      3rd Qu.:0.5260   3rd Qu.:17.83  \n Max.   :171.00   Max.   :3.849      Max.   :0.6560   Max.   :20.29  \n                                                                     \n  net_height_m   area_swept_km2     performance      species_code  \n Min.   :1.300   Min.   :0.02017   Min.   :0.0000   Min.   :21740  \n 1st Qu.:1.875   1st Qu.:0.04725   1st Qu.:0.0000   1st Qu.:21740  \n Median :2.064   Median :0.04944   Median :0.0000   Median :21740  \n Mean   :2.107   Mean   :0.04892   Mean   :0.1075   Mean   :21740  \n 3rd Qu.:2.343   3rd Qu.:0.05134   3rd Qu.:0.0000   3rd Qu.:21740  \n Max.   :3.196   Max.   :0.06369   Max.   :6.2200   Max.   :21740  \n                                                    NA's   :2      \n   cpue_kgkm2       cpue_nokm2         count          weight_kg      \n Min.   :     0   Min.   :     0   Min.   :   0.0   Min.   :   0.00  \n 1st Qu.:  1431   1st Qu.:  2238   1st Qu.: 111.5   1st Qu.:  70.64  \n Median :  3273   Median :  5842   Median : 280.0   Median : 161.44  \n Mean   :  6331   Mean   : 11473   Mean   : 569.4   Mean   : 313.74  \n 3rd Qu.:  6946   3rd Qu.: 12345   3rd Qu.: 611.5   3rd Qu.: 349.81  \n Max.   :148680   Max.   :202321   Max.   :9997.0   Max.   :7346.49  \n                                                                     \n taxon_confidence   scientific_name    common_name          id_rank         \n Length:376         Length:376         Length:376         Length:376        \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n                                                                            \n     worms             itis       \n Min.   :300735   Min.   :934083  \n 1st Qu.:300735   1st Qu.:934083  \n Median :300735   Median :934083  \n Mean   :300735   Mean   :934083  \n 3rd Qu.:300735   3rd Qu.:934083  \n Max.   :300735   Max.   :934083  \n NA's   :2        NA's   :2       \n```\n\n\n:::\n\n```{.r .cell-code}\n# Print the first few lines of the data \ndat %>% \n  head(3) %>% \n  flextable::flextable() %>%\n  flextable::colformat_num(\n      x = ., \n      j = c(\"year\", \"cruise\", \"cruisejoin\", \"species_code\"), \n      big.mark = \"\") %>% \n  flextable::theme_zebra()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-65f2a104{}.cl-65e15980{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-65e15994{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-65e7c6c6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-65e7c6da{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-65e7fe52{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65e7fe5c{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65e7fe66{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65e7fe67{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65e7fe70{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65e7fe71{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-65f2a104'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">year</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">srvy</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">survey</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">survey_name</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">survey_definition_id</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">cruise</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">cruisejoin</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">hauljoin</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">haul</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">stratum</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">station</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">vessel_id</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">vessel_name</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">date_time</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">latitude_dd_start</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">longitude_dd_start</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">latitude_dd_end</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">longitude_dd_end</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">bottom_temperature_c</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">surface_temperature_c</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">depth_m</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">distance_fished_km</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">duration_hr</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">net_width_m</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">net_height_m</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">area_swept_km2</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">performance</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">species_code</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">cpue_kgkm2</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">cpue_nokm2</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">count</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">weight_kg</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">taxon_confidence</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">scientific_name</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">common_name</span></p></th><th class=\"cl-65e7fe5c\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15980\">id_rank</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">worms</span></p></th><th class=\"cl-65e7fe52\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15980\">itis</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">2023</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">EBS</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">eastern Bering Sea</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">98</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">202301</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-759</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-22,123</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">25</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">10</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">E-12</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">162</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">ALASKA KNIGHT</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">2023-05-28T15:56:41Z</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">56.33791</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-160.9950</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">56.33839</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-161.0420</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">4.0</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">4.2</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">54</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">2.917</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">0.522</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">16.079</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">1.983</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">0.046902</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">0</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">21740</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">3,969.8145</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">4,413.416</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">207</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">186.194</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">High</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">Gadus chalcogrammus</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">walleye pollock</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">species</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">300,735</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">934,083</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">2023</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">EBS</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">eastern Bering Sea</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">98</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">202301</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-759</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-22,125</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">27</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">31</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">F-13</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">162</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">ALASKA KNIGHT</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">2023-05-29T10:48:20Z</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">56.65813</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-160.3893</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">56.67233</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-160.3497</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">3.7</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">3.7</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">59</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">2.900</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">0.525</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">17.206</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">1.932</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">0.049897</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">0</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">21740</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">3,872.0254</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">8,477.396</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">423</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">193.204</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">High</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">Gadus chalcogrammus</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">walleye pollock</span></p></td><td class=\"cl-65e7fe71\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">species</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">300,735</span></p></td><td class=\"cl-65e7fe70\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">934,083</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">2023</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">EBS</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">eastern Bering Sea</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">Eastern Bering Sea Crab/Groundfish Bottom Trawl Survey</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">98</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">202301</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-759</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-22,126</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">28</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">10</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">F-14</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">162</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">ALASKA KNIGHT</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">2023-05-29T14:17:28Z</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">56.67258</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-159.7784</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">56.68401</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">-159.7380</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">4.6</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">4.7</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">37</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">2.790</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">0.511</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">15.529</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">2.355</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">0.043326</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">0</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">21740</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">172.2526</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">553.941</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">24</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">7.463</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">High</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">Gadus chalcogrammus</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">walleye pollock</span></p></td><td class=\"cl-65e7fe67\"><p class=\"cl-65e7c6da\"><span class=\"cl-65e15994\">species</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">300,735</span></p></td><td class=\"cl-65e7fe66\"><p class=\"cl-65e7c6c6\"><span class=\"cl-65e15994\">934,083</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n### Visualize CPUE data in distribution map\n\nUsing the zero-filled data from the previous example, we can make a few plots! \n\n## Plot locations\n\n\n::: {.cell tbl-cap='CPUE (kg/km^2) of walleye pollock catch at each station in the 2023 eastern Bering Sea bottom trawl survey. Size of black circles denote magnitude of CPUE caught at station and red triangles denote stations where walleye pollock were not caught. '}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot2::ggplot(data = dat %>% dplyr::filter(cpue_kgkm2 != 0), \n                mapping = aes(x = longitude_dd_start, \n                              y = latitude_dd_start, \n                              size = cpue_kgkm2)) + \n  ggplot2::geom_point(alpha = .75) +\n  ggplot2::geom_point(data = dat %>% dplyr::filter(cpue_kgkm2 == 0), \n                      color = \"red\", \n                      shape = 17,\n                      alpha = .75,\n                      size = 3) +\n  ggplot2::xlab(\"Longitude *W\") +\n  ggplot2::ylab(\"Latitude *N\") +\n  ggplot2::ggtitle(label = \"Catches of walleye pollock (Weight CPUE; kg/km2)\", \n                   subtitle = \"2023 eastern Bering Sea bottom trawl survey\") +\n  ggplot2::scale_size_continuous(name = \"Weight (kg)\") + \n  ggplot2::theme_bw()\n```\n\n::: {.cell-output-display}\n![](foss-api-r_files/figure-html/pollock-multi1-loc-1.png){width=672}\n:::\n:::\n\n\n### Plot inverse-distance weighted modeled product of locations\n\nThis map is constructed using [`akgfmaps`](https://github.com/afsc-gap-products/akgfmaps)\n\n\n::: {.cell tbl-cap='Inverse-distance weight CPUE of walleye pollock catch at each station in the 2023 eastern Bering Sea bottom trawl survey. '}\n\n```{.r .cell-code}\n# devtools::install_github(\"afsc-gap-products/akgfmaps\", build_vignettes = TRUE)\nlibrary(akgfmaps)\n\nfigure0 <- akgfmaps::make_idw_map(\n  CPUE_KGHA = dat$cpue_kgkm2, # calculates the same, regardless of units.  \n  LATITUDE = dat$latitude_dd_start, \n  LONGITUDE = dat$longitude_dd_start, \n  region = \"bs.south\", # Predefined EBS area\n  set.breaks = \"jenks\", # Gets Jenks breaks from classint::classIntervals()\n  in.crs = \"+proj=longlat\", # Set input coordinate reference system\n  out.crs = \"EPSG:3338\", # Set output coordinate reference system\n  extrapolation.grid.type = \"sf\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[inverse distance weighted interpolation]\n[inverse distance weighted interpolation]\n```\n\n\n:::\n\n```{.r .cell-code}\nfigure0$plot + # 20x20km grid\n  ggplot2::guides(fill=guide_legend(title = \"walleye pollock\\nCPUE (kg/km2)\"))\n```\n\n::: {.cell-output-display}\n![](foss-api-r_files/figure-html/pollock-multi2-loc-1.png){width=672}\n:::\n:::\n\n\n## Other query examples\n\n### Ex. Combination of year, srvy, stratum\n\nShow haul data where year is less than 1989, srvy = \"EBS\", and stratum is not equal to 81. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- httr::GET(\n  url = paste0(api_link_haul, \n               '?&limit=10000&q={\"year\":{\"$lt\":1989},\"stratum\":{\"$ne\":\"81\"},\"srvy\":\"EBS\"}}'))\ndata <- jsonlite::fromJSON(base::rawToChar(res$content))\ndat <- data$items %>% \n  dplyr::select(-links) # necessary for API accounting, but not part of the dataset)\n```\n:::\n\n\nExplore data:\n\n\n\n",
    "supporting": [
      "foss-api-r_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}